<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    <title>atlantic8</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="A note is preferable to the best memory">
<meta property="og:type" content="website">
<meta property="og:title" content="atlantic8">
<meta property="og:url" content="atlantic8.github.io/page/11/index.html">
<meta property="og:site_name" content="atlantic8">
<meta property="og:description" content="A note is preferable to the best memory">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="atlantic8">
<meta name="twitter:description" content="A note is preferable to the best memory">
    

    

    
        <link rel="icon" href="/css/images/logo.png">
    

    <link rel="stylesheet" href="/libs/font-awesome5/css/fontawesome.min.css">
    <link rel="stylesheet" href="/libs/font-awesome5/css/fa-brands.min.css">
    <link rel="stylesheet" href="/libs/font-awesome5/css/fa-solid.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    
        <script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?ff86ad40748d96af89d192e9b0a3ae62";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

    


</head>
</html>
<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">atlantic8</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories/OJ">OJ</a>
                
                    <a class="main-nav-link" href="/categories/Algorithm">Algorithm</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/f35.png" />
                            <i class="fas fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fas fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories/OJ">OJ</a></td>
                
                    <td><a class="main-nav-link" href="/categories/Algorithm">Algorithm</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile" class="profile-fixed">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/f35.png" />
            <h2 id="name">Atlantic8</h2>
            <h3 id="title">algorithm engineer</h3>
            <span id="location"><i class="fas fa-map-marker-alt" style="padding-right: 5px"></i>Beijing, China</span>
            <a id="follow" target="_blank" href="https://github.com/Atlantic8">关注我</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                119
                <span>文章</span>
            </div>
            <div class="article-info-block">
                45
                <span>标签</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/Atlantic8" target="_blank" title="github" class=tooltip>
                            
                                <i class="fab fa-github"></i>
                            
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://www.linkedin.com/in/wenqiang-cao-704236b8/" target="_blank" title="linkedin" class=tooltip>
                            
                                <i class="fab fa-linkedin"></i>
                            
                        </a>
                    </td>
                    
                    <td>
                        <a href="mailto:atlantic8@outlook.com" target="_blank" title="envelope" class=tooltip>
                            
                                <i class="fas fa-envelope"></i>
                            
                        </a>
                    </td>
                    
                    <td>
                        <a href="http://weibo.com/2614093607" target="_blank" title="weibo" class=tooltip>
                            
                                <i class="fab fa-weibo"></i>
                            
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            
                                <i class="fab fa-facebook"></i>
                            
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-python数据规整-分组-聚合" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/08/15/python数据规整-分组-聚合/">python数据规整_分组_聚合</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2016/08/15/python数据规整-分组-聚合/">
            <time datetime="2016-08-15T11:09:26.000Z" itemprop="datePublished">2016-08-15</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/python/">python</a>, <a class="tag-link" href="/tags/数据分析/">数据分析</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h4 id="数据合并"><a href="#数据合并" class="headerlink" title="数据合并"></a>数据合并</h4><h5 id="DataFrame合并"><a href="#DataFrame合并" class="headerlink" title="DataFrame合并"></a>DataFrame合并</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> DataFrame,Series</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">pd.merge(***)</span><br></pre></td></tr></table></figure>
<h6 id="merge方法"><a href="#merge方法" class="headerlink" title="merge方法"></a>merge方法</h6><center>merge函数的参数</center>

<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">param</th>
<th style="text-align:center">explanation</th>
<th style="text-align:center">param</th>
<th style="text-align:center">explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">left</td>
<td style="text-align:center">左侧的DataFrame</td>
<td style="text-align:center">right</td>
<td style="text-align:center">右侧的DataFrame</td>
</tr>
<tr>
<td style="text-align:center">how</td>
<td style="text-align:center">连接方式，inner、outer、left、right，默认为inner</td>
<td style="text-align:center">on</td>
<td style="text-align:center">指定连接的列名</td>
</tr>
<tr>
<td style="text-align:center">left_on</td>
<td style="text-align:center">左侧DataFrame用于连接的键名</td>
<td style="text-align:center">right_on</td>
<td style="text-align:center">右侧DataFrame用于连接的键名</td>
</tr>
<tr>
<td style="text-align:center">left_index</td>
<td style="text-align:center">将左侧的行索引用作其连接键</td>
<td style="text-align:center">right_index</td>
<td style="text-align:center">将右侧的行索引用作其连接键</td>
</tr>
<tr>
<td style="text-align:center">sort</td>
<td style="text-align:center">对合并后的数据在连接键上排序，默认为True</td>
<td style="text-align:center">suffixes</td>
<td style="text-align:center">重叠列名后缀，用于重复列名区分</td>
</tr>
<tr>
<td style="text-align:center">copy</td>
<td style="text-align:center">默认为True，设置为False可以避免将数据复制到结果数据结构中</td>
<td style="text-align:center">————</td>
<td style="text-align:center">————-</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">left1 = DataFrame(&#123;<span class="string">'key'</span>:[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'a'</span>,<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>], <span class="string">'value'</span>:range(<span class="number">6</span>)&#125;)</span><br><span class="line">$-&gt; key  value</span><br><span class="line"><span class="number">0</span>   a      <span class="number">0</span></span><br><span class="line"><span class="number">1</span>   b      <span class="number">1</span></span><br><span class="line"><span class="number">2</span>   a      <span class="number">2</span></span><br><span class="line"><span class="number">3</span>   a      <span class="number">3</span></span><br><span class="line"><span class="number">4</span>   b      <span class="number">4</span></span><br><span class="line"><span class="number">5</span>   c      <span class="number">5</span></span><br><span class="line"></span><br><span class="line">right1 = DataFrame(&#123;<span class="string">'group_val'</span>:[<span class="number">2</span>,<span class="number">5</span>]&#125;,index=[<span class="string">'a'</span>,<span class="string">'b'</span>])</span><br><span class="line">$-&gt; group_val</span><br><span class="line">a          <span class="number">2</span></span><br><span class="line">b          <span class="number">5</span></span><br><span class="line"></span><br><span class="line">pd.merge(left1, right1, left_on=<span class="string">'key'</span>, right_index=<span class="keyword">True</span>)</span><br><span class="line">$-&gt; key  value  group_val</span><br><span class="line"><span class="number">0</span>   a      <span class="number">0</span>          <span class="number">2</span></span><br><span class="line"><span class="number">2</span>   a      <span class="number">2</span>          <span class="number">2</span></span><br><span class="line"><span class="number">3</span>   a      <span class="number">3</span>          <span class="number">2</span></span><br><span class="line"><span class="number">1</span>   b      <span class="number">1</span>          <span class="number">5</span></span><br><span class="line"><span class="number">4</span>   b      <span class="number">4</span>          <span class="number">5</span></span><br></pre></td></tr></table></figure>
<p><b>层次化索引应当以列表的形式指明用作合并键的多个列<b></b></b></p>
<h6 id="join方法"><a href="#join方法" class="headerlink" title="join方法"></a>join方法</h6><ul>
<li>join方法可以更为方便地实现按索引合并</li>
<li>可以合并多个带有相同或相似索引的DataFrame对象</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># on指定调用者的连接键</span></span><br><span class="line">left.join(right, how=<span class="string">''</span>, on=<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多个DataFrame合并</span></span><br><span class="line">another = DataFrame(....)</span><br><span class="line">left2.join([right2, another])</span><br></pre></td></tr></table></figure>
<h6 id="concat方法"><a href="#concat方法" class="headerlink" title="concat方法"></a>concat方法</h6><p>concat方法用于轴向连接、绑定、堆叠操作<br>numpy有一个合并原始NumPy数组的concatenate的函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr = np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line"><span class="comment"># axis=1水平连接，axis=0垂直连接</span></span><br><span class="line">np.concatenate([arr, arr], axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">s1 = Series([<span class="number">0</span>,<span class="number">1</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>])</span><br><span class="line">s2 = Series([<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], index=[<span class="string">'c'</span>,<span class="string">'d'</span>, <span class="string">'e'</span>])</span><br><span class="line">s3 = Series([<span class="number">5</span>,<span class="number">6</span>], index=[<span class="string">'f'</span>, <span class="string">'g'</span>])</span><br><span class="line"><span class="comment"># 默认 axis=0</span></span><br><span class="line">pd.concat([s1, s2, s3])</span><br><span class="line">$-&gt; a    0</span><br><span class="line">    b    <span class="number">1</span></span><br><span class="line">    c    <span class="number">2</span></span><br><span class="line">    d    <span class="number">3</span></span><br><span class="line">    e    <span class="number">4</span></span><br><span class="line">    f    <span class="number">5</span></span><br><span class="line">    g    <span class="number">6</span></span><br><span class="line">    dtype: int64</span><br><span class="line"></span><br><span class="line">pd.concat([s1, s2, s3], axis=<span class="number">1</span>)</span><br><span class="line">$-&gt; 0    1    2</span><br><span class="line">a  <span class="number">0.0</span>  NaN  NaN</span><br><span class="line">b  <span class="number">1.0</span>  NaN  NaN</span><br><span class="line">c  NaN  <span class="number">2.0</span>  NaN</span><br><span class="line">d  NaN  <span class="number">3.0</span>  NaN</span><br><span class="line">e  NaN  <span class="number">4.0</span>  NaN</span><br><span class="line">f  NaN  NaN  <span class="number">5.0</span></span><br><span class="line">g  NaN  NaN  <span class="number">6.0</span></span><br></pre></td></tr></table></figure>
<center>concat函数的参数</center>

<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">param</th>
<th style="text-align:center">explanation</th>
<th style="text-align:center">param</th>
<th style="text-align:center">explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">objs</td>
<td style="text-align:center">参与连接的pandas对象的列表或字典，必需参数</td>
<td style="text-align:center">axis</td>
<td style="text-align:center">指明连接轴向，默认为0，参考上面示例</td>
</tr>
<tr>
<td style="text-align:center">join</td>
<td style="text-align:center">连接方式，inner、outer，默认为outer</td>
<td style="text-align:center">join_axes</td>
<td style="text-align:center">指明其他n-1条轴的索引，不执行并集、交集运算</td>
</tr>
<tr>
<td style="text-align:center">keys</td>
<td style="text-align:center">用于形成连接轴上的层次化索引</td>
<td style="text-align:center">levels</td>
<td style="text-align:center">指定层次化索引上各级别的索引</td>
</tr>
<tr>
<td style="text-align:center">names</td>
<td style="text-align:center">用于创建分层级别的索引，如果设置了keys和levels的话</td>
<td style="text-align:center">verify_integrity</td>
<td style="text-align:center">检查结果对象新轴上的重复对象</td>
</tr>
<tr>
<td style="text-align:center">ignore_index</td>
<td style="text-align:center">不保留连接轴上的索引，产生新索引range()</td>
<td style="text-align:center">——-</td>
<td style="text-align:center">———————-</td>
</tr>
</tbody>
</table>
</div>
<p><b>重塑层次化索引</b></p>
<ul>
<li>stack 将数据的列‘旋转’为行</li>
<li>unstack 将数据的行‘旋转’为列</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">data = DataFrame(np.arange(<span class="number">6</span>).reshape((<span class="number">2</span>,<span class="number">3</span>)), index=pd.Index([<span class="string">'Ohio'</span>,<span class="string">'Colorado'</span>],name=<span class="string">'state'</span>), columns=pd.Index([<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'three'</span>],name=<span class="string">'number'</span>))</span><br><span class="line">$-&gt; data</span><br><span class="line">number    one  two  three</span><br><span class="line">state</span><br><span class="line">Ohio        <span class="number">0</span>    <span class="number">1</span>      <span class="number">2</span></span><br><span class="line">Colorado    <span class="number">3</span>    <span class="number">4</span>      <span class="number">5</span></span><br><span class="line"></span><br><span class="line">result = data.stack()</span><br><span class="line">result</span><br><span class="line">$-&gt; state     number</span><br><span class="line">    Ohio      one       <span class="number">0</span></span><br><span class="line">                two       <span class="number">1</span></span><br><span class="line">              three     <span class="number">2</span></span><br><span class="line">    Colorado  one       <span class="number">3</span></span><br><span class="line">              two       <span class="number">4</span></span><br><span class="line">              three     <span class="number">5</span></span><br><span class="line">    dtype: int32</span><br><span class="line"></span><br><span class="line">result.unstack()</span><br><span class="line">$-&gt; number    one  two  three</span><br><span class="line">    state</span><br><span class="line">    Ohio        <span class="number">0</span>    <span class="number">1</span>      <span class="number">2</span></span><br><span class="line">    Colorado    <span class="number">3</span>    <span class="number">4</span>      <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># unstack(和stack一样)默认操作的是最内层地址，给函数传入层次级别的编号或者名称即可在不同级别操作。</span></span><br><span class="line">result.unstack(<span class="number">0</span>)</span><br><span class="line">$-&gt; state   Ohio  Colorado</span><br><span class="line">    number</span><br><span class="line">    one        <span class="number">0</span>         <span class="number">3</span></span><br><span class="line">    two        <span class="number">1</span>         <span class="number">4</span></span><br><span class="line">    three      <span class="number">2</span>         <span class="number">5</span></span><br><span class="line">result.unstack(<span class="string">'state'</span>)  <span class="comment"># 效果同上</span></span><br></pre></td></tr></table></figure>
<p>unstack操作可能会产生缺失值，而stack操作默认会过滤缺失值，可以设置参数dropna=False取消。</p>
<h4 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h4><h5 id="去重"><a href="#去重" class="headerlink" title="去重"></a>去重</h5><ul>
<li>DataFrame的duplicated()方法返回一个bool型Series实例，指示每一行是否是重复行</li>
<li>DataFrame的drop_duplicates()方法返回一个移除重复行的DataFrame</li>
<li>drop_duplicates()默认保留第一个出现的值组合，设置take_last=True则保留最后一个</li>
<li>指定部分列进行重复项判断，drop_duplicates([‘a1’, ‘a2’])</li>
</ul>
<h5 id="替换"><a href="#替换" class="headerlink" title="替换"></a>替换</h5><ul>
<li>Series中的replace函数可以进行替换操作</li>
<li>data.replace(a, b)</li>
<li>data.replace([a1, a2], b)</li>
<li>data.replace([a1, a2], [b1, b2])</li>
</ul>
<h5 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h5><ul>
<li>Series的map方法接受一个函数，或者含有映射关系的字典对象，返回一个映射后的Series对象</li>
<li>data.map(str.lower)</li>
<li>data.map(lambda x : str.lower(x))</li>
</ul>
<h5 id="离散化与bin划分"><a href="#离散化与bin划分" class="headerlink" title="离散化与bin划分"></a>离散化与bin划分</h5><ul>
<li>cut函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">ages = [<span class="number">20</span>,<span class="number">22</span>,<span class="number">25</span>,<span class="number">27</span>,<span class="number">21</span>,<span class="number">23</span>,<span class="number">37</span>,<span class="number">31</span>,<span class="number">61</span>,<span class="number">45</span>,<span class="number">41</span>,<span class="number">32</span>]</span><br><span class="line">bins = [<span class="number">18</span>, <span class="number">25</span>, <span class="number">35</span>, <span class="number">60</span> ,<span class="number">100</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将ages按照bins划分进行切割</span></span><br><span class="line"><span class="comment"># 直接切割得到的区间是左开右闭的，设置right=False可以得到左闭右开区间</span></span><br><span class="line"><span class="comment"># 设置参数labels=['a1','a2',...,'an']可以更改区间名称</span></span><br><span class="line"><span class="comment"># 也可以不传入bins，直接传入整数n表示分成n个区间，函数会根据最值等间距划分</span></span><br><span class="line"></span><br><span class="line">cats = pd.cut(ages, bins)</span><br><span class="line">cats</span><br><span class="line">$-&gt; [(18, 25], (18, 25], (18, 25], (25, 35], (18, 25], ..., (25, 35], (</span><br><span class="line">      <span class="number">60</span>, <span class="number">100</span>], (<span class="number">35</span>, <span class="number">60</span>], (<span class="number">35</span>, <span class="number">60</span>], (<span class="number">25</span>, <span class="number">35</span>]]</span><br><span class="line">    Length: <span class="number">12</span></span><br><span class="line">    Categories (<span class="number">4</span>, object): [(<span class="number">18</span>, <span class="number">25</span>] &lt; (<span class="number">25</span>, <span class="number">35</span>] &lt; (<span class="number">35</span>, <span class="number">60</span>] &lt; (<span class="number">60</span>, <span class="number">100</span>]</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">cats.codes   <span class="comment">#每个数据的标签</span></span><br><span class="line">$-&gt; array([0, 0, 0, 1, 0, 0, 2, 1, 3, 2, 2, 1], dtype=int8)</span><br><span class="line">cats.categories  <span class="comment">#区间信息</span></span><br><span class="line">$-&gt; Index([u'(18, 25]', u'(25, 35]', u'(35, 60]', u'(60, 100]'], dtype='object')</span><br><span class="line"></span><br><span class="line"><span class="comment"># 简单统计</span></span><br><span class="line">pd.value_count(cats)</span><br><span class="line">$-&gt; (18, 25]     5</span><br><span class="line">    (<span class="number">35</span>, <span class="number">60</span>]     <span class="number">3</span></span><br><span class="line">    (<span class="number">25</span>, <span class="number">35</span>]     <span class="number">3</span></span><br><span class="line">    (<span class="number">60</span>, <span class="number">100</span>]    <span class="number">1</span></span><br><span class="line">    dtype: int64</span><br></pre></td></tr></table></figure>
<ul>
<li>qcut函数根据样本分位数对样本进行划分，可以使得每个bin中的数据数量比较接近</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">data = np.random.rand(<span class="number">1000</span>)</span><br><span class="line"><span class="comment"># 5分位数</span></span><br><span class="line">cats = pd.qcut(data, <span class="number">5</span>)</span><br><span class="line">pd.value_counts(cats)</span><br><span class="line">$-&gt; (0.813, 1]           200</span><br><span class="line">    (<span class="number">0.628</span>, <span class="number">0.813</span>]       <span class="number">200</span></span><br><span class="line">    (<span class="number">0.421</span>, <span class="number">0.628</span>]       <span class="number">200</span></span><br><span class="line">    (<span class="number">0.223</span>, <span class="number">0.421</span>]       <span class="number">200</span></span><br><span class="line">    [<span class="number">0.000386</span>, <span class="number">0.223</span>]    <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义的分位数</span></span><br><span class="line">cats = pd.qcut(data, [<span class="number">0</span>, <span class="number">0.1</span>, <span class="number">0.5</span>, <span class="number">0.9</span>, <span class="number">1.0</span>])</span><br><span class="line">pd.value_counts(cats)</span><br><span class="line">$-&gt; (0.539, 0.901]       400</span><br><span class="line">    (<span class="number">0.127</span>, <span class="number">0.539</span>]       <span class="number">400</span></span><br><span class="line">    (<span class="number">0.901</span>, <span class="number">1</span>]           <span class="number">100</span></span><br><span class="line">    [<span class="number">0.000386</span>, <span class="number">0.127</span>]    <span class="number">100</span></span><br><span class="line">    dtype: int64</span><br></pre></td></tr></table></figure>
<h5 id="检测和过滤异常值"><a href="#检测和过滤异常值" class="headerlink" title="检测和过滤异常值"></a>检测和过滤异常值</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">data = DataFrame(np.random.randn(<span class="number">1000</span>,<span class="number">4</span>))</span><br><span class="line">col = data[<span class="number">3</span>]</span><br><span class="line"><span class="comment"># 找出某一列中绝对值大于3的值</span></span><br><span class="line">col[np.abs(col) &gt; <span class="number">3</span>]</span><br><span class="line"><span class="comment"># 找出data中全部大于3的值</span></span><br><span class="line">data[(np.abs(data) &gt; <span class="number">3</span>).any(<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 替换异常值</span></span><br><span class="line">data[np.abs(data) &gt; <span class="number">3</span>] = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h5 id="排列和随机采样"><a href="#排列和随机采样" class="headerlink" title="排列和随机采样"></a>排列和随机采样</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">np.random.permutation(<span class="number">5</span>)</span><br><span class="line"><span class="comment"># 整数采样，从[0,5)区间上采，样本空间为20</span></span><br><span class="line">np.random.randint(<span class="number">0</span>,<span class="number">5</span>,<span class="number">20</span>)</span><br></pre></td></tr></table></figure>
<h5 id="计算指示变量、哑变量"><a href="#计算指示变量、哑变量" class="headerlink" title="计算指示变量、哑变量"></a>计算指示变量、哑变量</h5><p>本节的作用是将分类变量转换为‘哑变量矩阵’（dummy matrix）或‘指示变量矩阵0-1’（indicator matrix）.如果DataFrame中的某一列有k个不同的值，则可以派生出一个k列矩阵或DataFrame<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">data = DataFrame(&#123;<span class="string">'key'</span>:[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'a'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>],<span class="string">'value'</span>:range(<span class="number">5</span>)&#125;)</span><br><span class="line">pd.get_dummies(data[<span class="string">'key'</span>])</span><br><span class="line">$-&gt; a    b    c    d</span><br><span class="line"><span class="number">0</span>  <span class="number">1.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">1.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">1.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">1.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">4</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="comment"># 为新生成的列名添加前缀</span></span><br><span class="line">pd.get_dummies(data[<span class="string">'key'</span>], prefix=<span class="string">'new_'</span>)</span><br></pre></td></tr></table></figure></p>
<h5 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h5><h6 id="python内置的字符串库"><a href="#python内置的字符串库" class="headerlink" title="python内置的字符串库"></a>python内置的字符串库</h6><ul>
<li>strip() 修剪空白符、换行符</li>
<li>split(‘xx’) 字符串分割</li>
<li>a.join(list): 在字符串a后面接上列表list（或元组）里所有的元素</li>
<li>str.index(‘,’) 在字符串str中找到’,’的位置，如果找不到则抛出异常</li>
<li>str.find(‘,’) 在字符串str中找’,’，找到返回第一个位置，找不到返回-1</li>
<li>str.rfind(‘,’) 在字符串str中找’,’，找到返回最后一个位置，找不到返回-1</li>
<li>str.count(‘,’) 统计str中’,’的个数</li>
<li>str.replace(‘aa’,’a’) 替换</li>
<li>str.lower(), upper()  大小写转换</li>
<li>str.ljust(n), rjust(n) 用空白字符填充以满足最小长度n</li>
</ul>
<h6 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h6><ul>
<li><p>正则表达式是用于处理字符串的强大工具，拥有自己独特的语法以及一个独立的处理引擎，效率上可能不如str自带的方法，但功能十分强大。得益于这一点，在提供了正则表达式的语言里，正则表达式的语法都是一样的，区别只在于不同的编程语言实现支持的语法数量不同。下图展示了使用正则表达式进行匹配的流程：</p>
<center>![](http://ww4.sinaimg.cn/mw690/9bcfe727jw1f6unc8s9fzj20d605w0ue.jpg)</center>
</li>
<li><p>下图列出了Python支持的正则表达式元字符和语法：</p>
<center>![](http://ww3.sinaimg.cn/mw690/9bcfe727jw1f6unc85kmxj20m71brniv.jpg)</center>
</li>
<li><p>正则表达式通常用于在文本中查找匹配的字符串。Python里数量词默认是贪婪的（在少数语言里也可能是默认非贪婪），总是尝试匹配尽可能多的字符；非贪婪的则相反，总是尝试匹配尽可能少的字符。例如：正则表达式”ab*”如果用于查找”abbbc”，将找到”abbb”。</p>
</li>
<li><p>与大多数编程语言相同，正则表达式里使用”\”作为转义字符，这就可能造成反斜杠困扰。假如你需要匹配文本中的字符”\”，那么使用编程语言表示的正则表达式里将需要4个反斜杠”\\\\”：前两个和后两个分别用于在编程语言里转义成反斜杠，转换成两个反斜杠后再在正则表达式里转义成一个反斜杠。Python里的原生字符串很好地解决了这个问题，这个例子中的正则表达式可以使用r”\\”表示。同样，匹配一个数字的”\\d”可以写成r”\d”。</p>
</li>
<li><p>re模块。Python通过re模块提供对正则表达式的支持。使用re的一般步骤是先将正则表达式的字符串形式编译为Pattern实例，然后使用Pattern实例处理文本并获得匹配结果（一个Match实例），最后使用Match实例获得信息，进行其他的操作。</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br></pre></td></tr></table></figure>
<ol>
<li><p>compile<br>re.compile(strPattern[, flag])<br>用于将字符串形式的正则表达式编译为Pattern对象,第二个参数flag是匹配模式，取值可以使用按位或运算符’|’表示同时生效。flag的可选值有：<br>re.I(re.IGNORECASE): 忽略大小写（括号内是完整写法，下同）<br>M(MULTILINE): 多行模式，改变’^’和’$’的行为（参见上图）<br>S(DOTALL): 点任意匹配模式，改变’.’的行为<br>L(LOCALE): 使预定字符类 \w \W \b \B \s \S 取决于当前区域设定<br>U(UNICODE): 使预定字符类 \w \W \b \B \s \S \d \D 取决于unicode定义的字符属性<br>X(VERBOSE): 详细模式。这个模式下正则表达式可以是多行，忽略空白字符，并可以加入注释</p>
</li>
<li><p>match<br>match(string[, pos[, endpos]]) | re.match(pattern, string[, flags])<br>这个方法将从string的pos下标处起尝试匹配pattern；如果pattern结束时仍可匹配，则返回一个Match对象；如果匹配过程中pattern无法匹配，或者匹配未结束就已到达endpos，则返回None。<br>pos和endpos的默认值分别为0和len(string)；re.match()无法指定这两个参数，参数flags用于编译pattern时指定匹配模式。 注意：这个方法并不是完全匹配。当pattern结束时若string还有剩余字符，仍然视为成功。想要完全匹配，可以在表达式末尾加上边界匹配符’$’。</p>
</li>
<li>split<br>split(string[, maxsplit]) | re.split(pattern, string[, maxsplit])<br>按照能够匹配的子串将string分割后返回列表。maxsplit用于指定最大分割次数，不指定将全部分割。</li>
<li>findall<br>findall(string[, pos[, endpos]]) | re.findall(pattern, string[, flags])<br>搜索string，以列表形式返回全部能匹配的子串</li>
<li>finditer<br>finditer(string[, pos[, endpos]]) | re.finditer(pattern, string[, flags])<br>搜索string，返回一个顺序访问每一个匹配结果（Match对象）的迭代器</li>
<li>sub<br>sub(repl, string[, count]) | re.sub(pattern, repl, string[, count])<br>使用repl替换string中每一个匹配的子串后返回替换后的字符串。<br>当repl是一个字符串时，可以使用\id或\g<id>、\g<name>引用分组，但不能使用编号0。<br>当repl是一个方法时，这个方法应当只接受一个参数（Match对象），并返回一个字符串用于替换（返回的字符串中不能再引用分组）。<br>count用于指定最多替换次数，不指定时全部替换。</name></id></li>
<li>subn<br>subn(repl, string[, count]) |re.sub(pattern, repl, string[, count])<br>返回 (sub(repl, string[, count]), 替换次数)</li>
</ol>
<p><b><a href="http://www.cnblogs.com/huxi/archive/2010/07/04/1771073.html" target="_blank" rel="noopener">原文地址与示例</a><b></b></b></p>
<h6 id="pandas中矢量化的字符串操作"><a href="#pandas中矢量化的字符串操作" class="headerlink" title="pandas中矢量化的字符串操作"></a>pandas中矢量化的字符串操作</h6><p>通过Series的str方法获取Series中值得字符串内容，函数示例</p>
<ul>
<li>data.str.constins(‘hello’), 返回一个bool型的Series对象</li>
<li>data.str.findall(pattern,flags=re.IGNORECASE)</li>
<li>matches = data.str.match(pattern, flags=re.IGNORECASE)</li>
<li>matches.str.get(1) 矢量化元素获取</li>
<li>matches.str[1] 矢量化元素获取(效果和上一个一致),也支持分片操作</li>
</ul>
<center>矢量化的字符串方法</center>

<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">method</th>
<th style="text-align:center">explanation</th>
<th style="text-align:center">method</th>
<th style="text-align:center">explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">cat</td>
<td style="text-align:center">元素级的字符串连接操作，可指定分隔符</td>
<td style="text-align:center">contains</td>
<td style="text-align:center">返回各字符串是否包含指定模式的bool数组</td>
</tr>
<tr>
<td style="text-align:center">count</td>
<td style="text-align:center">模式出现的次数</td>
<td style="text-align:center">endswith,startswith</td>
<td style="text-align:center">各元素是否以指定的模式开头、结尾，返回bool数组</td>
</tr>
<tr>
<td style="text-align:center">findall</td>
<td style="text-align:center">计算各字符串的模式列表</td>
<td style="text-align:center">get</td>
<td style="text-align:center">获取各元素的第i个字符</td>
</tr>
<tr>
<td style="text-align:center">join</td>
<td style="text-align:center">根据指定的分隔符将各元素的字符串连接起来</td>
<td style="text-align:center">len</td>
<td style="text-align:center">计算各字符串的长度</td>
</tr>
<tr>
<td style="text-align:center">lower,upper</td>
<td style="text-align:center">大小写转换</td>
<td style="text-align:center">match</td>
<td style="text-align:center">根据给定模式，执行re.match()</td>
</tr>
<tr>
<td style="text-align:center">pad</td>
<td style="text-align:center">在字符串左边/右边或两边添加空白符</td>
<td style="text-align:center">center</td>
<td style="text-align:center">相当于pad(side=’both’)</td>
</tr>
<tr>
<td style="text-align:center">repeat</td>
<td style="text-align:center">重复操作，在字符串上就是多个相同的拼接</td>
<td style="text-align:center">replace</td>
<td style="text-align:center">替换指定模式</td>
</tr>
<tr>
<td style="text-align:center">slice</td>
<td style="text-align:center">对各个字符串进行子串分片操作</td>
<td style="text-align:center">split</td>
<td style="text-align:center">根据指定模式，对字符串切割</td>
</tr>
<tr>
<td style="text-align:center">strip,rstrip,lstrip</td>
<td style="text-align:center">去空白符，换行符</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<h4 id="数据聚合"><a href="#数据聚合" class="headerlink" title="数据聚合"></a>数据聚合</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">df</span><br><span class="line">$-&gt;   data1     data2 key1 key2</span><br><span class="line"><span class="number">0</span>  <span class="number">2.128648</span>  <span class="number">0.552487</span>    a  one</span><br><span class="line"><span class="number">1</span>  <span class="number">2.040146</span> <span class="number">-0.974248</span>    a  two</span><br><span class="line"><span class="number">2</span> <span class="number">-1.442976</span> <span class="number">-0.404534</span>    b  one</span><br><span class="line"><span class="number">3</span>  <span class="number">1.796789</span> <span class="number">-1.413561</span>    b  two</span><br><span class="line"><span class="number">4</span>  <span class="number">0.429355</span>  <span class="number">0.604959</span>    a  one</span><br></pre></td></tr></table></figure>
<h5 id="GroupBy"><a href="#GroupBy" class="headerlink" title="GroupBy"></a>GroupBy</h5><ul>
<li>groupby用于DataFrame上，假定要按‘key’进行分组，并计算‘value’列的值，默认在axis=0上分组</li>
<li>grouped = df[‘value’].groupby(df[‘key’])   grouped是一个GroupBy对象，只包含一些有关分组建的中间数据</li>
<li>上面的等价语法为：df.groupby(df[‘key’])[‘value’]或者df.groupby(df[‘key’])[[‘value’]]</li>
<li>grouped.mean()  使用GroupBy的方法进行计算</li>
<li>分组键可以不止一个，groupby(df[‘key1’,’key2’])，得到层次索引结果</li>
<li>分组键可是任意长度适当的数组，可以是字符串、数字或其他python对象，比如’key1’，也可以按照列的类型dtype进行分组: df.groupby(df.dtypes, axis=1)</li>
<li>df.groupby(df[‘key’]).mean() 对df的所有数值列求值，非数值列自动忽略</li>
<li>df.groupby(df[‘key’]).size() 返回含有分组大小的Series</li>
<li>grouped.describe()等方法也是可以用在这里的</li>
</ul>
<h5 id="分组迭代"><a href="#分组迭代" class="headerlink" title="分组迭代"></a>分组迭代</h5><ul>
<li>GroupBy对象支持迭代，可以产生一组二元分组（由分组名和数据块组成）</li>
<li>for name,group in df.groupby(df[‘key’]) 将返回df[‘key’]每一种可能的值以及其对应的df行集合</li>
<li>for (k1, k2),group in df.groupby(df[‘key1’, ‘key2’])</li>
</ul>
<p>groupby对象字典化<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">grouped = df.groupby(<span class="string">'key1'</span>)</span><br><span class="line"></span><br><span class="line">glist = list(grouped)  <span class="comment"># glist中包含的是(分组名, 数据块)组成的元组</span></span><br><span class="line">$-&gt; [('a',</span><br><span class="line">        data1     data2 key1 key2</span><br><span class="line">  <span class="number">0</span>  <span class="number">2.128648</span>  <span class="number">0.552487</span>    a  one</span><br><span class="line">  <span class="number">1</span>  <span class="number">2.040146</span> <span class="number">-0.974248</span>    a  two</span><br><span class="line">  <span class="number">4</span>  <span class="number">0.429355</span>  <span class="number">0.604959</span>    a  one),</span><br><span class="line">     (<span class="string">'b'</span>,</span><br><span class="line">        data1     data2 key1 key2</span><br><span class="line">  <span class="number">2</span> <span class="number">-1.442976</span> <span class="number">-0.404534</span>    b  one</span><br><span class="line">  <span class="number">3</span>  <span class="number">1.796789</span> <span class="number">-1.413561</span>    b  two)]</span><br><span class="line"></span><br><span class="line">gdict = dict(glist)  <span class="comment"># 字典化</span></span><br><span class="line">$-&gt; &#123;'a':       data1     data2 key1 key2</span><br><span class="line">         <span class="number">0</span>  <span class="number">2.128648</span>  <span class="number">0.552487</span>    a  one</span><br><span class="line">         <span class="number">1</span>  <span class="number">2.040146</span> <span class="number">-0.974248</span>    a  two</span><br><span class="line">         <span class="number">4</span>  <span class="number">0.429355</span>  <span class="number">0.604959</span>    a  one,</span><br><span class="line">     <span class="string">'b'</span>:       data1     data2 key1 key2</span><br><span class="line">         <span class="number">2</span> <span class="number">-1.442976</span> <span class="number">-0.404534</span>    b  one</span><br><span class="line">         <span class="number">3</span>  <span class="number">1.796789</span> <span class="number">-1.413561</span>    b  two&#125;</span><br><span class="line"></span><br><span class="line">dict(list(df.groupby(df.dtypes, axis=<span class="number">1</span>)))</span><br></pre></td></tr></table></figure></p>
<h5 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h5><h6 id="通过字典或者Series进行分组"><a href="#通过字典或者Series进行分组" class="headerlink" title="通过字典或者Series进行分组"></a>通过字典或者Series进行分组</h6><p>比如说现在dataframe有列’a’,’b’,’c’,’d’,’e’，通过如下代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mapping = &#123;<span class="string">'a'</span>:<span class="string">'red'</span>,<span class="string">'b'</span>:<span class="string">'blue'</span>,<span class="string">'c'</span>:<span class="string">'red'</span>,<span class="string">'d'</span>:<span class="string">'red'</span>,<span class="string">'e'</span>:<span class="string">'blue'</span>&#125;</span><br><span class="line"><span class="comment"># 将字典传给groupby函数，设置axis=1（这是合并列）</span></span><br><span class="line">by_column = df.groupby(mapping, axis=<span class="number">1</span>)</span><br><span class="line">by_column.sum()  <span class="comment"># 对映射到相同名称的列求和，结果的列只有'red'和'blue'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Series也有同样的功能</span></span><br><span class="line">map_series(mapping)</span><br><span class="line">df.groupby(map_series, axis=<span class="number">1</span>).sum()</span><br></pre></td></tr></table></figure></p>
<h6 id="通过函数进行分组"><a href="#通过函数进行分组" class="headerlink" title="通过函数进行分组"></a>通过函数进行分组</h6><p>比如说索引为字符串，若想按照字符串长度进行分组，则可以：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">df.groupby(len).sum()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将函数跟数组、列表、字典等结合起来使用也可以</span></span><br><span class="line">key_list = [<span class="string">'one'</span>,<span class="string">'one'</span>,<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'two'</span>]</span><br><span class="line">df.groupby([len, key_list]).sum() <span class="comment"># 得到一个层次化索引的结果</span></span><br></pre></td></tr></table></figure></p>
<h6 id="通过索引级别进行分组"><a href="#通过索引级别进行分组" class="headerlink" title="通过索引级别进行分组"></a>通过索引级别进行分组</h6><p>通过level关键字传入级别编号或名称，按照索引级别进行分组<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">columns = pd.MultiIndex.from_arrays([[<span class="string">'US'</span>,<span class="string">'US'</span>,<span class="string">'US'</span>,<span class="string">'JP'</span>,<span class="string">'JP'</span>],[<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">3</span>]], names=[<span class="string">'country'</span>,<span class="string">'tenor'</span>])</span><br><span class="line">df = DataFrame(np.random.randn(<span class="number">4</span>,<span class="number">5</span>), columns=columns)</span><br><span class="line">df.groupby(level=<span class="string">'country'</span>, axis=<span class="number">1</span>).count()</span><br><span class="line">$-&gt;</span><br><span class="line">country  JP  US</span><br><span class="line"><span class="number">0</span>         <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">1</span>         <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">2</span>         <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">3</span>         <span class="number">2</span>   <span class="number">3</span></span><br></pre></td></tr></table></figure></p>
<h5 id="聚合方法"><a href="#聚合方法" class="headerlink" title="聚合方法"></a>聚合方法</h5><p>自定义聚合函数，将其传入<b>agg或者aggregate方法</b>即可</p>
<center>经过优化的groupby方法，可以传入函数名字符串进行调用</center>

<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">method</th>
<th style="text-align:center">explanation</th>
<th style="text-align:center">method</th>
<th style="text-align:center">explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">count</td>
<td style="text-align:center">分组中非NAN值的数量</td>
<td style="text-align:center">sum</td>
<td style="text-align:center">非NAN值的和</td>
</tr>
<tr>
<td style="text-align:center">mean</td>
<td style="text-align:center">非NAN值的均值</td>
<td style="text-align:center">median</td>
<td style="text-align:center">非NAN值的中值</td>
</tr>
<tr>
<td style="text-align:center">std,var</td>
<td style="text-align:center">无偏(分母n-1)标准差和方差</td>
<td style="text-align:center">min,max</td>
<td style="text-align:center">非NAN值的最值</td>
</tr>
<tr>
<td style="text-align:center">prod</td>
<td style="text-align:center">非NAN值的乘积</td>
<td style="text-align:center">first,last</td>
<td style="text-align:center">第一个、最后一个非NAN值</td>
</tr>
</tbody>
</table>
</div>
<h6 id="面向列的多函数应用"><a href="#面向列的多函数应用" class="headerlink" title="面向列的多函数应用"></a>面向列的多函数应用</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 传入一个函数列表执行多个函数，每个函数的执行结果单成一列</span></span><br><span class="line">grouped[<span class="string">'data3'</span>].agg([<span class="string">'mean'</span>, <span class="string">'std'</span>, my_function])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 传入由(name, function)元组组成的列表时，每个元组第一个元素成为结果DataFrame的列名，第二个元素是对应此列名上的函数</span></span><br><span class="line">grouped.agg([(<span class="string">'data1'</span>,<span class="string">'mean'</span>), (<span class="string">'data2'</span>,<span class="string">'std'</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不同的列对应不同的函数，可传入字典</span></span><br><span class="line">grouped.agg(&#123;<span class="string">'data1'</span>:[<span class="string">'min'</span>,<span class="string">'max'</span>], <span class="string">'data2'</span>:[np.max, <span class="string">'std'</span>])</span><br></pre></td></tr></table></figure>
<h6 id="聚合结果索引变换"><a href="#聚合结果索引变换" class="headerlink" title="聚合结果索引变换"></a>聚合结果索引变换</h6><p>python聚合返回结果时，向groupby函数传入: <b>as_index=False<b> 取消由分组键形成索引，而是将分组键变成列，把简单数字作为索引。对结果调用reset_index()也能得到这样的结果。</b></b></p>
<h4 id="分组运算与转换"><a href="#分组运算与转换" class="headerlink" title="分组运算与转换"></a>分组运算与转换</h4><h5 id="transform"><a href="#transform" class="headerlink" title="transform"></a>transform</h5><p>transform函数接收一个函数，并将这个函数应用到各个分组，然后将每个分组的结果放置在这个分组对应的每一个元素上，最后显示它。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">people</span><br><span class="line">$-&gt;</span><br><span class="line">               a         b         c         d         e</span><br><span class="line">Joe    <span class="number">-0.338386</span>  <span class="number">0.849100</span> <span class="number">-1.951048</span> <span class="number">-1.153923</span> <span class="number">-1.672975</span></span><br><span class="line">Steve  <span class="number">-0.490588</span>  <span class="number">0.408497</span> <span class="number">-0.692801</span> <span class="number">-0.100917</span>  <span class="number">0.970808</span></span><br><span class="line">Wes    <span class="number">-1.603786</span>       NaN       NaN <span class="number">-0.534380</span>  <span class="number">0.847692</span></span><br><span class="line">Jim     <span class="number">0.309432</span>  <span class="number">2.768331</span> <span class="number">-0.454094</span> <span class="number">-1.026735</span> <span class="number">-0.679794</span></span><br><span class="line">Travis <span class="number">-1.400938</span> <span class="number">-0.865599</span> <span class="number">-0.190541</span> <span class="number">-0.835916</span>  <span class="number">0.315975</span></span><br><span class="line"></span><br><span class="line">key=[<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'one'</span>]</span><br><span class="line">people.groupby(key).mean()</span><br><span class="line">$-&gt;      a         b         c         d         e</span><br><span class="line">one <span class="number">-1.114370</span> <span class="number">-0.008250</span> <span class="number">-1.070794</span> <span class="number">-0.841406</span> <span class="number">-0.169769</span></span><br><span class="line">two <span class="number">-0.090578</span>  <span class="number">1.588414</span> <span class="number">-0.573447</span> <span class="number">-0.563826</span>  <span class="number">0.145507</span></span><br><span class="line"></span><br><span class="line">people.groupby(key).transform(np.mean)</span><br><span class="line">$-&gt;         a         b         c         d         e</span><br><span class="line">Joe    <span class="number">-1.114370</span> <span class="number">-0.008250</span> <span class="number">-1.070794</span> <span class="number">-0.841406</span> <span class="number">-0.169769</span></span><br><span class="line">Steve  <span class="number">-0.090578</span>  <span class="number">1.588414</span> <span class="number">-0.573447</span> <span class="number">-0.563826</span>  <span class="number">0.145507</span></span><br><span class="line">Wes    <span class="number">-1.114370</span> <span class="number">-0.008250</span> <span class="number">-1.070794</span> <span class="number">-0.841406</span> <span class="number">-0.169769</span></span><br><span class="line">Jim    <span class="number">-0.090578</span>  <span class="number">1.588414</span> <span class="number">-0.573447</span> <span class="number">-0.563826</span>  <span class="number">0.145507</span></span><br><span class="line">Travis <span class="number">-1.114370</span> <span class="number">-0.008250</span> <span class="number">-1.070794</span> <span class="number">-0.841406</span> <span class="number">-0.169769</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 传入自定义的函数也可以，需要注意的是自定义函数的输入参数是已经分好组的各个分组</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_function</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> arr-arr.mean()</span><br></pre></td></tr></table></figure></p>
<h5 id="apply：拆分-应用-合并"><a href="#apply：拆分-应用-合并" class="headerlink" title="apply：拆分-应用-合并"></a>apply：拆分-应用-合并</h5><ul>
<li>apply 将待处理的对象拆成多个分段，然后对各分段调用传入的函数，最后尝试将各分段组合到一起</li>
<li>分段组合需要用到pandas.concat函数</li>
<li>apply 传入函数名，这里传入的函数需要包括：分好组的DataFrame分段，也可以包括一些其他的参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 取列'tip_pct'排前五的记录</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">top</span><span class="params">(df, n=<span class="number">5</span>, col=<span class="string">'tip_pct'</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> df.sort_index(by=col)[-n:]</span><br><span class="line">df.groupby(<span class="string">'smoker'</span>).apply(top)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁止分组键</span></span><br><span class="line">df.groupby(<span class="string">'smoker'</span>, group_keys=<span class="keyword">False</span>).apply(top)</span><br></pre></td></tr></table></figure>
<h6 id="分位数和桶分析"><a href="#分位数和桶分析" class="headerlink" title="分位数和桶分析"></a>分位数和桶分析</h6><ul>
<li>pandas中面元划分、样本分位数划分的函数cut和qcut可以和groupby结合起来</li>
<li>函数cut和qcut返回的对象可以作为groupby函数的参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_status</span><span class="params">(group)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'min'</span>:group.min, <span class="string">'max'</span>:group.max, <span class="string">'count'</span>:group.count&#125;</span><br><span class="line"></span><br><span class="line">factor = pd.cut(df.data1, <span class="number">4</span>) <span class="comment"># labels=False，只获取分位数编号</span></span><br><span class="line">grouped = df.data2.groupby(factor)</span><br><span class="line">grouped.apply(get_status).unstack()</span><br></pre></td></tr></table></figure>
<h5 id="透视表与交叉表"><a href="#透视表与交叉表" class="headerlink" title="透视表与交叉表"></a>透视表与交叉表</h5><h6 id="透视表"><a href="#透视表" class="headerlink" title="透视表"></a>透视表</h6><ul>
<li>根据一个或多个键对数据进行聚合，并根据行和列上的分组键将数据分配到各个矩形区域中</li>
<li>DataFrame有个pivot_table函数</li>
<li>顶级函数：pandas.pivot_table</li>
</ul>
<center>pivot_table的参数</center>

<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">method</th>
<th style="text-align:center">explanation</th>
<th style="text-align:center">method</th>
<th style="text-align:center">explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">values</td>
<td style="text-align:center">待聚合列的名称，默认为所有数值列</td>
<td style="text-align:center">rows</td>
<td style="text-align:center">用于分组的列名或其他分组键，出现在结果透视图的行</td>
</tr>
<tr>
<td style="text-align:center">cols</td>
<td style="text-align:center">用于分组的列名或其他分组键，出现在结果透视图的列</td>
<td style="text-align:center">aggfunc</td>
<td style="text-align:center">聚合函数或函数列表，默认为mean。可以是任何对groupby有效的函数</td>
</tr>
<tr>
<td style="text-align:center">fill_value</td>
<td style="text-align:center">用于替换结果表中的缺失值</td>
<td style="text-align:center">margin</td>
<td style="text-align:center">添加行列小计，默认为False</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一个参数是表格内容，如果不设置，则默认为pivot_table中的默认聚合类型</span></span><br><span class="line"><span class="comment"># 设置参数 rows，设置行内容和索引，</span></span><br><span class="line"><span class="comment"># 设置参数 cols，设置列内容和索引</span></span><br><span class="line">tips.pivot_table([<span class="string">'tip_pct'</span>,<span class="string">'size'</span>], rows=[<span class="string">'sex'</span>,<span class="string">'day'</span>], cols=<span class="string">'smoker'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置：margins=True，添加分项小计，默认为平均值</span></span><br><span class="line">tips.pivot_table([<span class="string">'tip_pct'</span>,<span class="string">'size'</span>], rows=[<span class="string">'sex'</span>,<span class="string">'day'</span>], cols=<span class="string">'smoker'</span>, margins=<span class="keyword">True</span>)</span><br><span class="line"><span class="comment"># 要使用其他小计函数，可以使用：aggfunc参数</span></span><br><span class="line">tips.pivot_table([<span class="string">'tip_pct'</span>,<span class="string">'size'</span>], rows=[<span class="string">'sex'</span>,<span class="string">'day'</span>], cols=<span class="string">'smoker'</span>, margins=<span class="keyword">True</span>,aggfunc=<span class="string">'sum'</span>)</span><br></pre></td></tr></table></figure>
<h6 id="交叉表"><a href="#交叉表" class="headerlink" title="交叉表"></a>交叉表</h6><ul>
<li>交叉表是一种用于计算分组频率的特殊透视表</li>
<li>pandas.crosstab函数可以统计交叉表</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># param1: 用于分组的列名或其他分组键，出现在结果透视图的行</span></span><br><span class="line"><span class="comment"># param2: 用于分组的列名或其他分组键，出现在结果透视图的列</span></span><br><span class="line"><span class="comment"># margins=True：行、列小计</span></span><br><span class="line">pd.crosstab(param1, param2, margins=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="atlantic8.github.io/2016/08/15/python数据规整-分组-聚合/" data-id="ck66fyo1l00a10wph6ppy9j8w" class="article-share-link"><i class="fas fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-python时间序列分析" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/08/15/python时间序列分析/">python时间序列分析</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2016/08/15/python时间序列分析/">
            <time datetime="2016-08-15T11:06:30.000Z" itemprop="datePublished">2016-08-15</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/python/">python</a>, <a class="tag-link" href="/tags/time-series-data/">time_series_data</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h4 id="基础工具"><a href="#基础工具" class="headerlink" title="基础工具"></a>基础工具</h4><h5 id="基础工具类，datetime模块"><a href="#基础工具类，datetime模块" class="headerlink" title="基础工具类，datetime模块"></a>基础工具类，datetime模块</h5><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">type</th>
<th style="text-align:center">explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">date</td>
<td style="text-align:center">以公历形式存储日历日期</td>
</tr>
<tr>
<td style="text-align:center">time</td>
<td style="text-align:center">以时、分、秒、毫秒形式存储时间</td>
</tr>
<tr>
<td style="text-align:center">datetime</td>
<td style="text-align:center">存储如期和时间</td>
</tr>
<tr>
<td style="text-align:center">timedelta</td>
<td style="text-align:center">两个datetime之间的差</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>datetime以毫秒形式存储日期和时间，datetime.timedelta表示两个datetime对象之间的时间差</li>
<li>可以给datetime加上、减去一个或者多个timedelta对象</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line">now = datetime.now()</span><br><span class="line">now.year, now.month, now.day</span><br><span class="line">$-&gt; datetime.datetime(2016, 8, 4, 15, 14, 36, 899000)</span><br><span class="line"></span><br><span class="line"><span class="comment"># timedelta只有days和seconds这两个成员</span></span><br><span class="line">delta = datetime(<span class="number">2011</span>,<span class="number">7</span>,<span class="number">2</span>)-datetime(<span class="number">2011</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">9</span>)</span><br><span class="line">delta.days, delta.seconds</span><br><span class="line">$-&gt; (0, 54000)</span><br><span class="line"></span><br><span class="line">delta = datetime(<span class="number">2011</span>,<span class="number">7</span>,<span class="number">2</span>)<span class="number">-2</span>*timedelta(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<h5 id="字符串和datetime的相互转换"><a href="#字符串和datetime的相互转换" class="headerlink" title="字符串和datetime的相互转换"></a>字符串和datetime的相互转换</h5><p>datetime -&gt; string</p>
<ul>
<li>str方法</li>
<li>strftime方法</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">stamp = datetime(<span class="number">2011</span>,<span class="number">8</span>,<span class="number">1</span>)</span><br><span class="line">str(stamp)</span><br><span class="line">$-&gt; '2011-08-01 00:00:00'</span><br><span class="line">stamp.strftime(<span class="string">'%Y-%m-%d'</span>)</span><br><span class="line">$-&gt; '2011-08-01'</span><br></pre></td></tr></table></figure>
<p>string -&gt; datetime</p>
<ul>
<li>datetime.strptime</li>
<li>dateutil的parser.parse方法，dateutil几乎可以理解所有人类能够理解的日期格式</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">value = <span class="string">'2011-1-25'</span></span><br><span class="line"><span class="comment"># 返回一个datetime对象</span></span><br><span class="line">datetime.strptime(value, <span class="string">'%Y-%m-%d'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dateutil.parse <span class="keyword">import</span> parse</span><br><span class="line">parse(<span class="string">'2011-03-12'</span>)</span><br></pre></td></tr></table></figure>
<h5 id="pandas中的时间数据处理"><a href="#pandas中的时间数据处理" class="headerlink" title="pandas中的时间数据处理"></a>pandas中的时间数据处理</h5><ul>
<li>pandas处理成组的时间数据</li>
<li>可以处理空值和非法值，用NaT表示</li>
<li>可能会把一些不是日期的字符串变成日期</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">datestr = [<span class="string">'2011-04-12'</span>,<span class="string">'2015-11-09'</span>]</span><br><span class="line">pd.to_datetime(datestr)</span><br></pre></td></tr></table></figure>
<h4 id="时间序列基础"><a href="#时间序列基础" class="headerlink" title="时间序列基础"></a>时间序列基础</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">dates = [datetime(<span class="number">2012</span>,<span class="number">1</span>,<span class="number">1</span>), datetime(<span class="number">2012</span>,<span class="number">1</span>,<span class="number">2</span>)]</span><br><span class="line"><span class="comment"># datetime对象放置在一个DatetimeIndex中，pandas会自动识别这个Series为时间序列数据</span></span><br><span class="line">ts = Series(np.random.randn(<span class="number">2</span>), index=dates)</span><br><span class="line"></span><br><span class="line"><span class="comment"># DatetimeIndex中的各个标量是pandas的TimeStamp对象</span></span><br><span class="line">ts.index[<span class="number">0</span>]</span><br><span class="line">$-&gt; Timestamp('2012-01-01 00:00:00')</span><br></pre></td></tr></table></figure>
<h5 id="索引与子集"><a href="#索引与子集" class="headerlink" title="索引与子集"></a>索引与子集</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以传入被解释为日期的字符串来访问</span></span><br><span class="line">ts[<span class="string">'2012-01-01'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切片操作，可以传入‘年’或者‘年月’</span></span><br><span class="line"><span class="comment"># periods决定date_range的长度</span></span><br><span class="line">longer_ts = Series(np.random.randn(<span class="number">1000</span>), index=pd.date_range(<span class="string">'1/1/2000'</span>,period=<span class="number">1000</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以像列表切片那样，可以传入字符串日期，datetime或TimeStamp对象</span></span><br><span class="line"><span class="comment"># 这样切片产生的是源数据的视图，与numpy数组的切片运算一致</span></span><br><span class="line">ts[datetime(<span class="number">2011</span>,<span class="number">1</span>,<span class="number">7</span>):] <span class="comment"># 2011-1-7起的所有数据</span></span><br><span class="line">ts[<span class="string">'1/6/2011'</span>:<span class="string">'1/11/2011'</span>] <span class="comment"># 从[2011-1-6, 2011-1-11)的数据</span></span><br><span class="line"></span><br><span class="line">ts.truncate(after=<span class="string">'1/1/2011'</span>) <span class="comment"># 也有类似的效果</span></span><br></pre></td></tr></table></figure>
<p>在Series与DataFrame中均适用，只要设置index即可</p>
<h5 id="日期范围"><a href="#日期范围" class="headerlink" title="日期范围"></a>日期范围</h5><h6 id="date-range"><a href="#date-range" class="headerlink" title="date_range"></a>date_range</h6><ul>
<li>pandas.date_range(start=s, end=e, period=p, freq=f, normalize=True)</li>
<li>[s, e)：决定了初始时间和结束时间</li>
<li>p：周期值，决定日期长度</li>
<li>f：决定频率，默认为’D’,表示天。常用频率见下表，更详细的见书本314页</li>
<li>normalize：True表示产生规范化到午夜的时间戳</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">value</th>
<th style="text-align:center">explanation</th>
<th style="text-align:center">value</th>
<th style="text-align:center">explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">D</td>
<td style="text-align:center">每日历日</td>
<td style="text-align:center">B</td>
<td style="text-align:center">每工作日</td>
</tr>
<tr>
<td style="text-align:center">H</td>
<td style="text-align:center">每小时</td>
<td style="text-align:center">T or min</td>
<td style="text-align:center">每分钟</td>
</tr>
<tr>
<td style="text-align:center">S</td>
<td style="text-align:center">每秒钟</td>
<td style="text-align:center">L or ms</td>
<td style="text-align:center">每毫秒</td>
</tr>
<tr>
<td style="text-align:center">U</td>
<td style="text-align:center">每微秒</td>
<td style="text-align:center">M</td>
<td style="text-align:center">每月最后一个日历日</td>
</tr>
<tr>
<td style="text-align:center">BM</td>
<td style="text-align:center">每月最后一个工作日</td>
<td style="text-align:center">MS</td>
<td style="text-align:center">每月第一个日历日</td>
</tr>
<tr>
<td style="text-align:center">W-MON,W-TUE,..</td>
<td style="text-align:center">从指定的星期几开始起的每一周</td>
<td style="text-align:center">BMS</td>
<td style="text-align:center">每月第一个工作日</td>
</tr>
<tr>
<td style="text-align:center">Q-JAN,Q-FEB,..</td>
<td style="text-align:center">从起始时间开始，每个季度最后一个月的最后一个工作日</td>
<td style="text-align:center">WOM-1MON,WOM-2MON,..WOM-1FRI..</td>
<td style="text-align:center">产生每月第x个星期几</td>
</tr>
</tbody>
</table>
</div>
<h6 id="日期偏移量"><a href="#日期偏移量" class="headerlink" title="日期偏移量"></a>日期偏移量</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.tseries.offsets <span class="keyword">import</span> Hour,Minute</span><br><span class="line">hour = Hour(<span class="number">4</span>)</span><br><span class="line"><span class="comment"># 也可以更加简洁地使用freq参数</span></span><br><span class="line"><span class="comment"># freq = '1h30min'</span></span><br><span class="line">pd.date_range(<span class="string">'1/1/2011'</span>, <span class="string">'1/2/2011'</span>, freq=<span class="string">'4h'</span>)</span><br><span class="line">$-&gt; DatetimeIndex(['2011-01-01 00:00:00', '2011-01-01 04:00:00',</span><br><span class="line">                   <span class="string">'2011-01-01 08:00:00'</span>, <span class="string">'2011-01-01 12:00:00'</span>,</span><br><span class="line">                      <span class="string">'2011-01-01 16:00:00'</span>, <span class="string">'2011-01-01 20:00:00'</span>,</span><br><span class="line">                      <span class="string">'2011-01-02 00:00:00'</span>],</span><br><span class="line">                  dtype=<span class="string">'datetime64[ns]'</span>, freq=<span class="string">'4H'</span>)</span><br></pre></td></tr></table></figure>
<h6 id="移动数据"><a href="#移动数据" class="headerlink" title="移动数据"></a>移动数据</h6><ul>
<li>Series和DataFrame都有一个shift方法用于移动数据</li>
<li>shift移动步长参数：正值后移，负值前移</li>
<li>shift也可以带有参数 freq，这种情况下，数据不变，索引移动(正值前移)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 计算变化率</span></span><br><span class="line">ts / ts.shift(<span class="number">1</span>) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">ts.shift(<span class="number">2</span>,freq=<span class="string">'D'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>日期偏移量可以做用在datetime或TimeStamp对象上</li>
<li>如果加的是锚点偏移量(如MonthEnd)，第一次会偏移到符合频率规则的下一日期</li>
<li>通过锚点偏移量的rollforward和rollback方法</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.tseries.offsets <span class="keyword">import</span> Day, MonthEnd</span><br><span class="line"></span><br><span class="line">now = datetime(<span class="number">2011</span>,<span class="number">2</span>,<span class="number">15</span>)</span><br><span class="line">now + MonthEnd()</span><br><span class="line">$-&gt; Timestamp('2011-02-28 00:00:00')</span><br><span class="line">now + MonthEnd(<span class="number">2</span>)</span><br><span class="line">$-&gt; Timestamp('2011-03-31 00:00:00')'</span><br><span class="line"></span><br><span class="line">offset = MonthEnd()</span><br><span class="line">offset.rollforward(now)</span><br><span class="line">$-&gt; Timestamp('2011-02-28 00:00:00')</span><br><span class="line">offset.rollback(now)</span><br><span class="line">$-&gt; Timestamp('2011-01-31 00:00:00')</span><br></pre></td></tr></table></figure>
<h5 id="时区处理"><a href="#时区处理" class="headerlink" title="时区处理"></a>时区处理</h5><p>时间序列、日期范围和时间戳都可以从naive型转化为本地化时区意识型，也可以从一个时区转化为另一个时区<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytz</span><br><span class="line"><span class="comment"># 常用时区列表</span></span><br><span class="line">pytz.common_timezones</span><br><span class="line"><span class="comment"># 获取时区对象</span></span><br><span class="line">tz = pytz.timezone(<span class="string">'UTC'</span>)</span><br></pre></td></tr></table></figure></p>
<p>默认情况下，pandas中的时区是naive的，其索引的<b>tz字段</b>为None<br>所以在生成日期范围的时候可以加上一个时区信息,设置tz参数。也可以直接使用tz_localize方法<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pd.date_range(<span class="string">'1/1/2001'</span>,period=<span class="number">10</span>,tz=<span class="string">'UTC'</span>)</span><br><span class="line"><span class="comment"># 完成本地化操作</span></span><br><span class="line">ts_utc = ts.tz_localize(<span class="string">'UTC'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 时区转化</span></span><br><span class="line">ts_utc.tz_convert(<span class="string">'US/Eastern'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 时间戳转换</span></span><br><span class="line">stamp = pd.TimeStamp(<span class="string">'2011-03-12 04:00'</span>)</span><br><span class="line">stamp_utc = stamp.tz_localize(<span class="string">'UTC'</span>)</span><br><span class="line">stamp_eu = stamp.tz_convert(<span class="string">'Europe/Moscow'</span>)</span><br><span class="line"></span><br><span class="line">stamp_moscow = pd.TimeStamp(<span class="string">'2011-03-12 04:00'</span>, tz=<span class="string">'Europe/Moscow'</span>)</span><br></pre></td></tr></table></figure></p>
<p>合并两个时间序列数据，时区不同时，结果自动转化为UTC时间。</p>
<h5 id="时期Period及其算术运算"><a href="#时期Period及其算术运算" class="headerlink" title="时期Period及其算术运算"></a>时期Period及其算术运算</h5><ul>
<li>时期Period表示的是时间区间，如数日、数月、数季、数年等，包含在pandas中</li>
<li>构造函数需要一个字符串或者整数，以及freq参数</li>
<li>pandas.period_range函数，pandas.PeriodIndex函数</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这个Period表示的是从2007-1-1到2007-12-31日之间的整段时间</span></span><br><span class="line"><span class="comment"># 可以被看成一个被划分成多个月度时期的时间段中的游标</span></span><br><span class="line">p = pd.Period(<span class="number">2007</span>,freq=<span class="string">'A-DEC'</span>)</span><br><span class="line"><span class="comment"># 与整数直接进行加、减法运算</span></span><br><span class="line">p + <span class="number">5</span></span><br><span class="line">$-&gt; Period('2012', 'A-DEC')</span><br><span class="line"></span><br><span class="line"><span class="comment"># Period对象之间的加、减法运算</span></span><br><span class="line"><span class="comment"># freq不同时会抛出异常</span></span><br><span class="line">pd.Period(<span class="string">'2014'</span>, freq=<span class="string">'A-DEC'</span>) - p</span><br><span class="line">$-&gt; 7L</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建时期范围</span></span><br><span class="line">pd.period_range(<span class="string">'1/1/2000'</span>, <span class="string">'6/30/2000'</span>, freq=<span class="string">'M'</span>)</span><br><span class="line"></span><br><span class="line">values = [<span class="string">'2001Q3'</span>, <span class="string">'2002Q2'</span>, <span class="string">'2003Q1'</span>]</span><br><span class="line">index = pd.PeriodIndex(values, freq=<span class="string">'Q-DEC'</span>)</span><br><span class="line">index $-&gt; PeriodIndex(['2001Q3', '2002Q2', '2003Q1'], dtype='int64', freq='Q-DEC')</span><br></pre></td></tr></table></figure>
<h6 id="时期的频率转换"><a href="#时期的频率转换" class="headerlink" title="时期的频率转换"></a>时期的频率转换</h6><p>Period和PeriodIndex对象都可以通过其asfreq方法被转换到其他频率<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">p = pd.Period(<span class="string">'2007'</span>, freq=<span class="string">'A-DEC'</span>)</span><br><span class="line">p.asfreq(<span class="string">'M'</span>,how=<span class="string">'start'</span>)</span><br><span class="line">$-&gt; Period('2007-01','M')</span><br><span class="line">p.asfreq(<span class="string">'M'</span>,how=<span class="string">'end'</span>)</span><br><span class="line">$-&gt; Period('2007-12','M')</span><br><span class="line">P.asfreq(<span class="string">'B'</span>,how=<span class="string">'start'</span>)</span><br><span class="line">$-&gt; Period('2007-01-01', 'B')</span><br><span class="line"></span><br><span class="line"><span class="comment"># 高频率转化为低频率</span></span><br><span class="line">p = pd.Period(<span class="string">'2007-08'</span>, <span class="string">'M'</span>)</span><br><span class="line">p.asfreq(<span class="string">'A-JUN'</span>)</span><br><span class="line"><span class="comment"># 在频率A-JUN中，2007-08实际上是属于2008年</span></span><br><span class="line">$-&gt; Period('2008','A-JUN')</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按季度计算的时期频率</span></span><br><span class="line"><span class="comment"># 频率为 Q-JAN,Q-FEB,Q-MAR,....Q-DEC, JAN starts from feb</span></span><br><span class="line">p = pd.Period(<span class="string">'2012Q4'</span>, freq=<span class="string">'Q-JAN'</span>)</span><br><span class="line"><span class="comment"># 2012年Q4是从2011-11-01到2012-01-31</span></span><br><span class="line">p.asfreq(<span class="string">'D'</span>, <span class="string">'start'</span>)</span><br><span class="line">$-&gt; Period('2011-11-01', 'D')</span><br><span class="line">p.asfreq(<span class="string">'D'</span>,<span class="string">'e'</span>)</span><br><span class="line">$-&gt; Period('2012-01-31', 'D')</span><br><span class="line"></span><br><span class="line"><span class="comment"># TimeStamp和Period的相互转换</span></span><br><span class="line"><span class="comment"># to_timestamp()和to_period('freq')方法</span></span><br><span class="line">ts = Series(np.random.randn(<span class="number">3</span>), index=pd.date_range(<span class="string">'1/1/2000'</span>,periods=<span class="number">3</span>,freq=<span class="string">'M'</span>))</span><br><span class="line">ts  $-&gt;</span><br><span class="line"><span class="number">2000</span><span class="number">-01</span><span class="number">-31</span>    <span class="number">2.375484</span></span><br><span class="line"><span class="number">2000</span><span class="number">-02</span><span class="number">-29</span>    <span class="number">0.726024</span></span><br><span class="line"><span class="number">2000</span><span class="number">-03</span><span class="number">-31</span>   <span class="number">-0.328938</span></span><br><span class="line">Freq: M, dtype: float64</span><br><span class="line"></span><br><span class="line">pts = ts.to_period()</span><br><span class="line">pts $-&gt;</span><br><span class="line"><span class="number">2000</span><span class="number">-01</span>    <span class="number">2.375484</span></span><br><span class="line"><span class="number">2000</span><span class="number">-02</span>    <span class="number">0.726024</span></span><br><span class="line"><span class="number">2000</span><span class="number">-03</span>   <span class="number">-0.328938</span></span><br><span class="line">Freq: M, dtype: float64</span><br><span class="line"></span><br><span class="line">pts.to_timestamp(how=<span class="string">'end'</span>)</span><br><span class="line">$-&gt;</span><br><span class="line"><span class="number">2000</span><span class="number">-01</span><span class="number">-31</span>    <span class="number">2.375484</span></span><br><span class="line"><span class="number">2000</span><span class="number">-02</span><span class="number">-29</span>    <span class="number">0.726024</span></span><br><span class="line"><span class="number">2000</span><span class="number">-03</span><span class="number">-31</span>   <span class="number">-0.328938</span></span><br><span class="line">Freq: M, dtype: float64</span><br></pre></td></tr></table></figure></p>
<p>通过数组创建PeriodIndex<br>固定频率的数据集通常会将时间信息分开存放在多个列中，将这些数据以及频率传入PeriodIndex中就可以将它们合并成一个DataFrame索引<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># quarter表示季度</span></span><br><span class="line">pd.PeriodIndex(year=data.year, quarter=data.quarter, freq=<span class="string">'Q-DEC'</span>)</span><br></pre></td></tr></table></figure></p>
<h5 id="重采样及频率转换"><a href="#重采样及频率转换" class="headerlink" title="重采样及频率转换"></a>重采样及频率转换</h5><ul>
<li>重采样指的是将时间序列从一个频率转换到另一个频率的处理过程</li>
<li>低频到高频称为升采样，反之为降采样</li>
<li>pandas对象都有一个resample方法</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">param</th>
<th style="text-align:center">explanation</th>
<th style="text-align:center">param</th>
<th style="text-align:center">explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">freq</td>
<td style="text-align:center">表示重采样频率的字符串或DataOffset,’M’,’5min’,Second(15)</td>
<td style="text-align:center">how=’mean’</td>
<td style="text-align:center">产生聚合的函数名或数组函数，默认为mean，还有’first’,’last’,’ohlc’,’min’</td>
</tr>
<tr>
<td style="text-align:center">axis=0</td>
<td style="text-align:center">采样轴，默认为axis=0</td>
<td style="text-align:center">fill_method=None</td>
<td style="text-align:center">升采样时的插值方式，可取’ffill’或’bfill’</td>
</tr>
<tr>
<td style="text-align:center">closed=’right’</td>
<td style="text-align:center">降采样中，时间段哪一端是闭合的</td>
<td style="text-align:center">label=’right’</td>
<td style="text-align:center">降采样中聚合值的标签</td>
</tr>
<tr>
<td style="text-align:center">loffset=None</td>
<td style="text-align:center">面元标签的时间校正值，-1s(Second(-1))将时间调早1s</td>
<td style="text-align:center">limit=None</td>
<td style="text-align:center">向前、向后填充时，允许填充的最大时期数</td>
</tr>
<tr>
<td style="text-align:center">kind=None</td>
<td style="text-align:center">聚合到时期或时间戳，默认聚合到时间序列的索引类型</td>
<td style="text-align:center">convention=None</td>
<td style="text-align:center">重采样时期，低频到高频所采用的约定(‘start’/‘end’)，默认为’end’</td>
</tr>
</tbody>
</table>
</div>
<h6 id="降采样"><a href="#降采样" class="headerlink" title="降采样"></a>降采样</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 聚合到5min范围，聚合函数为'sum'求和</span></span><br><span class="line">ts.resample(<span class="string">'5min'</span>, how=<span class="string">'sum'</span>)</span><br><span class="line"></span><br><span class="line">ts.resample(<span class="string">'5min'</span>, how=<span class="string">'sum'</span>, closed=<span class="string">'left'</span>, label=<span class="string">'left'</span>, loffset=<span class="string">'-1s'</span>)</span><br></pre></td></tr></table></figure>
<p>OHLC重采样</p>
<ul>
<li>经常应用于金融数据的采样方法，计算各面元的四个值，分别是第一个值（open/开盘）、最后一个值（close/收盘）、最大值（high/最高）、最小值（low/最低）</li>
<li>传入how=’ohlc’即可得到含有这四种聚合值的DataFrame</li>
<li>ts.resample(‘5min’, how=’ohlc’)</li>
<li>也可以通过groupby进行重采样</li>
<li>ts.groupby(lambda x: x.month).mean()</li>
<li>ts.groupby(lambda x: x.weekday).mean()</li>
</ul>
<h6 id="升采样"><a href="#升采样" class="headerlink" title="升采样"></a>升采样</h6><ul>
<li>升采样过程中，不需要聚合，需要插值</li>
<li>既不是降采样也不是升采样的采样，需要传入新的频率 frame.resample(‘W-MON’,fill_method=’ffill’)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">frame = DataFrame(np.random.randn(<span class="number">2</span>,<span class="number">4</span>),index=pd.date_range(<span class="string">'1/1/2000'</span>,periods=<span class="number">2</span>,freq=<span class="string">'W-WED'</span>),columns=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line">frame</span><br><span class="line">$-&gt;               a         b         c         d</span><br><span class="line"><span class="number">2000</span><span class="number">-01</span><span class="number">-05</span> <span class="number">-0.550387</span> <span class="number">-1.294863</span>  <span class="number">0.274911</span>  <span class="number">0.330741</span></span><br><span class="line"><span class="number">2000</span><span class="number">-01</span><span class="number">-12</span>  <span class="number">2.512896</span> <span class="number">-1.719330</span>  <span class="number">0.090617</span>  <span class="number">0.329635</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置fill_method为ffill或者bfill，不设置时，引入缺失值</span></span><br><span class="line"><span class="comment"># 如果设置limit值，则只填充limit行</span></span><br><span class="line">frame.resample(<span class="string">'D'</span>, fill_method=<span class="string">'ffill'</span>, limit=<span class="number">4</span>)</span><br><span class="line">$-&gt;                a         b         c         d</span><br><span class="line"><span class="number">2000</span><span class="number">-01</span><span class="number">-05</span> <span class="number">-0.550387</span> <span class="number">-1.294863</span>  <span class="number">0.274911</span>  <span class="number">0.330741</span></span><br><span class="line"><span class="number">2000</span><span class="number">-01</span><span class="number">-06</span> <span class="number">-0.550387</span> <span class="number">-1.294863</span>  <span class="number">0.274911</span>  <span class="number">0.330741</span></span><br><span class="line"><span class="number">2000</span><span class="number">-01</span><span class="number">-07</span> <span class="number">-0.550387</span> <span class="number">-1.294863</span>  <span class="number">0.274911</span>  <span class="number">0.330741</span></span><br><span class="line"><span class="number">2000</span><span class="number">-01</span><span class="number">-08</span> <span class="number">-0.550387</span> <span class="number">-1.294863</span>  <span class="number">0.274911</span>  <span class="number">0.330741</span></span><br><span class="line"><span class="number">2000</span><span class="number">-01</span><span class="number">-09</span> <span class="number">-0.550387</span> <span class="number">-1.294863</span>  <span class="number">0.274911</span>  <span class="number">0.330741</span></span><br><span class="line"><span class="number">2000</span><span class="number">-01</span><span class="number">-10</span>       NaN       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span><span class="number">-01</span><span class="number">-11</span>       NaN       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span><span class="number">-01</span><span class="number">-12</span>  <span class="number">2.512896</span> <span class="number">-1.719330</span>  <span class="number">0.090617</span>  <span class="number">0.329635</span></span><br></pre></td></tr></table></figure>
<h5 id="绘图中的移动窗口函数"><a href="#绘图中的移动窗口函数" class="headerlink" title="绘图中的移动窗口函数"></a>绘图中的移动窗口函数</h5><ul>
<li>移动窗口上计算的各种函数也是一类常见于时间序列的数组变换，称之为移动窗口函数</li>
<li>它们接受TimeSeries或DataFrame对象，以及一个窗口长度。它们是pandas的函数</li>
</ul>
<center>移动窗口和指数加权函数</center>

<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">function</th>
<th style="text-align:center">explanation</th>
<th style="text-align:center">function</th>
<th style="text-align:center">explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">rolling_count</td>
<td style="text-align:center">各窗口非NA观测值的数量</td>
<td style="text-align:center">rolling_sum</td>
<td style="text-align:center">窗口和</td>
</tr>
<tr>
<td style="text-align:center">rolling_mean</td>
<td style="text-align:center">窗口均值</td>
<td style="text-align:center">rolling_median</td>
<td style="text-align:center">窗口中位数</td>
</tr>
<tr>
<td style="text-align:center">rolling_var,rolling_std</td>
<td style="text-align:center">窗口无偏方差、标准差(n-1)</td>
<td style="text-align:center">rolling_skew,rolling_kurt</td>
<td style="text-align:center">窗口三阶矩(偏度)、四阶矩(峰度)</td>
</tr>
<tr>
<td style="text-align:center">rolling_min,rolling_max</td>
<td style="text-align:center">窗口的最值</td>
<td style="text-align:center">rolling_quantile</td>
<td style="text-align:center">窗口制定百分数、分位数位置的值</td>
</tr>
<tr>
<td style="text-align:center">rolling_corr,rolling_cov</td>
<td style="text-align:center">窗口的相关系数和协方差</td>
<td style="text-align:center">rolling_apply</td>
<td style="text-align:center">对窗口应用普通数组函数</td>
</tr>
<tr>
<td style="text-align:center">ewma</td>
<td style="text-align:center">指数加权移动平均</td>
<td style="text-align:center">ewmvar,ewmstd</td>
<td style="text-align:center">指数加权移动方差和标准差</td>
</tr>
<tr>
<td style="text-align:center">ewmcorr,ewmcov</td>
<td style="text-align:center">指数加权移动相关系数和协方差</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<p>这些函数均不考虑NA值，bottlenect则是NA友好的窗口移动函数集。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 窗口长度为250</span></span><br><span class="line">pd.rooling_mean(data[<span class="string">'col1'</span>], <span class="number">250</span>, min_periods=<span class="number">10</span>).plot()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将rolling_mean()函应用到所有列上,画出所有列对应的数据</span></span><br><span class="line">expanding = <span class="keyword">lambda</span> x : rolling_mean(x, len(x), min_periods=<span class="number">1</span>)</span><br><span class="line">pd.rolling_mean(data, <span class="number">60</span>).plot(logy=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure></p>
<h6 id="指数加权函数"><a href="#指数加权函数" class="headerlink" title="指数加权函数"></a>指数加权函数</h6><ul>
<li>通过定义一个衰减因子，decay factor，使得近期的观测值拥有更大的权重</li>
<li>衰减因子定义可以使用：时间间隔span，兼容于窗口大小等于时间间隔的简单移动窗口函数</li>
<li>具有较强的适应性</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pd.ewma(data[<span class="string">'col1'</span>], span=<span class="number">60</span>).plot()</span><br><span class="line"><span class="comment"># ewmvar, ewmstd的使用同理</span></span><br></pre></td></tr></table></figure>
<h6 id="二元移动窗口函数"><a href="#二元移动窗口函数" class="headerlink" title="二元移动窗口函数"></a>二元移动窗口函数</h6><ul>
<li>作用在两个个序列上的函数，比如相关性计算和协方差计算</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pd.rolling_corr(series1, series2, <span class="number">100</span>, min_periods=<span class="number">100</span>).plot()</span><br><span class="line"><span class="comment"># 计算一个序列与DataFrame的各个列的相关关系时</span></span><br><span class="line">data = DataFrame(...)</span><br><span class="line">pd.rolling_corr(data, series, <span class="number">100</span>, min_periods=<span class="number">100</span>).plot()</span><br></pre></td></tr></table></figure>
<h6 id="用户定义的移动窗口函数"><a href="#用户定义的移动窗口函数" class="headerlink" title="用户定义的移动窗口函数"></a>用户定义的移动窗口函数</h6><ul>
<li>使用rolling_apply()函数，需要自定义函数作为参数输入</li>
<li>自定义函数要求：能从数组的各个片段中产生单个值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># percentileofscore(x,y)可用于计算样本x中特定值y的百分等级</span></span><br><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> percentileofscore</span><br><span class="line">score_at_2percent = <span class="keyword">lambda</span> x: percentileofscore(x, <span class="number">0.02</span>)</span><br><span class="line">pd.rolling_apply(data[<span class="string">'col'</span>], <span class="number">200</span>, score_at_2percent)</span><br></pre></td></tr></table></figure>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="atlantic8.github.io/2016/08/15/python时间序列分析/" data-id="ck66fyo3300ci0wphj6b06f78" class="article-share-link"><i class="fas fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-NumPy进阶" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/08/15/NumPy进阶/">NumPy进阶</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2016/08/15/NumPy进阶/">
            <time datetime="2016-08-15T11:03:52.000Z" itemprop="datePublished">2016-08-15</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/numpy/">numpy</a>, <a class="tag-link" href="/tags/python/">python</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h5 id="数组重塑"><a href="#数组重塑" class="headerlink" title="数组重塑"></a>数组重塑</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</span><br><span class="line"></span><br><span class="line"><span class="comment"># reshape函数</span></span><br><span class="line">arr = np.arange(<span class="number">8</span>)</span><br><span class="line">arr.reshape((<span class="number">4</span>, <span class="number">2</span>)).sahpe</span><br><span class="line">$-&gt; (4, 2)</span><br><span class="line">arr.reshape((<span class="number">5</span>,<span class="number">-1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 扁平化函数</span></span><br><span class="line"><span class="comment"># flatten函数返回数据副本，ravel则不是</span></span><br><span class="line"><span class="comment"># 这些函数可以带有指示顺序的参数：&#123;'C':行有限, 'F':列优先&#125;</span></span><br><span class="line">arr = np.arange(<span class="number">15</span>).reshape((<span class="number">5</span>, <span class="number">3</span>))</span><br><span class="line">arr.ravel()</span><br><span class="line">$-&gt; array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14])</span><br><span class="line">arr.flatten()</span><br><span class="line">$-&gt; array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14])</span><br><span class="line">arr.ravel(<span class="string">'F'</span>)</span><br><span class="line">$-&gt; array([ 0,  3,  6,  9, 12,  1,  4,  7, 10, 13,  2,  5,  8, 11, 14])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拆分合并</span></span><br><span class="line">arr1 = np.array([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]])</span><br><span class="line">arr2 = np.array([[<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>],[<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>]])</span><br><span class="line">np.concatenate([arr1, arr2], axis=<span class="number">0</span>)</span><br><span class="line">$-&gt; array([[ 1,  2,  3],</span><br><span class="line">              [ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>],</span><br><span class="line">           [ <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>],</span><br><span class="line">           [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]])</span><br><span class="line"></span><br><span class="line">np.concatenate([arr1, arr2], axis=<span class="number">1</span>)</span><br><span class="line">$-&gt; array([[ 1,  2,  3,  7,  8,  9],</span><br><span class="line">           [ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># vstack(垂直方向的连接), hstack(水平方向的连接)</span></span><br><span class="line"><span class="comment"># 里面的圆括号也可以换成方括号</span></span><br><span class="line">np.vstack((arr1, arr2))</span><br><span class="line">$-&gt; array([[ 1,  2,  3],</span><br><span class="line">           [ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>],</span><br><span class="line">           [ <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>],</span><br><span class="line">           [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]])</span><br><span class="line"></span><br><span class="line">np.hstack([arr1, arr2])</span><br><span class="line">$-&gt; array([[ 1,  2,  3,  7,  8,  9],</span><br><span class="line">           [ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># split</span></span><br><span class="line">arr = randn(<span class="number">5</span>, <span class="number">2</span>)</span><br><span class="line">first, second, third = np.split(arr,[<span class="number">1</span>,<span class="number">3</span>])</span><br><span class="line">first</span><br><span class="line">$-&gt; array([[-0.28435497,  0.71298716]])</span><br><span class="line">second</span><br><span class="line">$-&gt; array([[ 0.48442513, -0.84460369],</span><br><span class="line">           [<span class="number">-0.38289692</span>, <span class="number">-1.11166995</span>]])</span><br><span class="line">third</span><br><span class="line">$-&gt; array([[-0.44724781,  0.52083756],</span><br><span class="line">           [<span class="number">-0.39584687</span>,  <span class="number">0.14325106</span>]])</span><br></pre></td></tr></table></figure>
<center>数组连接函数</center>

<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">method</th>
<th style="text-align:center">explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">concatenate</td>
<td style="text-align:center">沿一条轴连接一组数组</td>
</tr>
<tr>
<td style="text-align:center">vstack,hstack</td>
<td style="text-align:center">垂直、水平连接</td>
</tr>
<tr>
<td style="text-align:center">row_stack</td>
<td style="text-align:center">按行连接，相当于vstack</td>
</tr>
<tr>
<td style="text-align:center">column_stack</td>
<td style="text-align:center">按列连接，相当于hstack</td>
</tr>
<tr>
<td style="text-align:center">dstack</td>
<td style="text-align:center">以面向‘深度’的方式堆叠，沿轴2</td>
</tr>
<tr>
<td style="text-align:center">split</td>
<td style="text-align:center">沿指定轴的指定位置拆分</td>
</tr>
<tr>
<td style="text-align:center">hsplit,vsplit,dsplit</td>
<td style="text-align:center">分别沿轴0、1、2切分</td>
</tr>
</tbody>
</table>
</div>
<p>元素重复操作<br>tile and repeat函数<br>tile沿指定轴向堆叠数组的副本<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">arr = np.arange(<span class="number">3</span>)</span><br><span class="line">arr.repeat(<span class="number">3</span>)</span><br><span class="line">$-&gt; array([0, 0, 0, 1, 1, 1, 2, 2, 2])</span><br><span class="line">arr.repeat([<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line">$-&gt; array([0, 0, 1, 1, 1, 2, 2, 2, 2])</span><br><span class="line"></span><br><span class="line">arr = np.arange(<span class="number">4</span>).reshape((<span class="number">2</span>,<span class="number">2</span>))</span><br><span class="line">arr.repeat([<span class="number">2</span>,<span class="number">3</span>], axis=<span class="number">0</span>)</span><br><span class="line">$-&gt; array([[0, 1],</span><br><span class="line">             [<span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">          [<span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">          [<span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">          [<span class="number">2</span>, <span class="number">3</span>]])</span><br><span class="line"></span><br><span class="line">np.tile(arr, <span class="number">2</span>)</span><br><span class="line">$-&gt; array([[0, 1, 0, 1],</span><br><span class="line">           [<span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>]])</span><br></pre></td></tr></table></figure></p>
<h5 id="广播"><a href="#广播" class="headerlink" title="广播"></a>广播</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">np.arange(<span class="number">4</span>) + <span class="number">3</span></span><br><span class="line">$-&gt; array([3, 4, 5, 6])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每一行减去均值时，直接减</span></span><br><span class="line"><span class="comment"># 每一列减时需要维度变化</span></span><br><span class="line">arr = np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line"><span class="comment"># 参数为0计算每列的均值，1则计算每行的均值</span></span><br><span class="line">arr.mean(<span class="number">0</span>)</span><br><span class="line">$-&gt; array([ 4.,  5.,  6.,  7.])</span><br><span class="line"></span><br><span class="line">arr - arr.mean(<span class="number">0</span>)</span><br><span class="line">$-&gt; array([[-4., -4., -4., -4.],</span><br><span class="line">           [ <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>],</span><br><span class="line">           [ <span class="number">4.</span>,  <span class="number">4.</span>,  <span class="number">4.</span>,  <span class="number">4.</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># arr - arr.mean(1)报错</span></span><br><span class="line"><span class="comment"># 沿其他轴广播，较小数组的‘广播维’必须为1，所以需要reshape()，把n变成(n,1)</span></span><br><span class="line">arr - arr.mean(<span class="number">1</span>).reshape((<span class="number">4</span>,<span class="number">1</span>))</span><br><span class="line">$-&gt; array([[-1.5, -0.5,  0.5,  1.5],</span><br><span class="line">           [<span class="number">-1.5</span>, <span class="number">-0.5</span>,  <span class="number">0.5</span>,  <span class="number">1.5</span>],</span><br><span class="line">           [<span class="number">-1.5</span>, <span class="number">-0.5</span>,  <span class="number">0.5</span>,  <span class="number">1.5</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一般解决方法是：专门为广播添加一个新轴</span></span><br><span class="line"><span class="comment"># 通过np.newaxis属性及全切片完成</span></span><br><span class="line">arr = randn(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line">depth_mean = arr.mean(<span class="number">2</span>)</span><br><span class="line">demean = arr - depth_mean[:,np.newaxis,:]</span><br><span class="line">demean.mean(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># 结果基本为0</span></span><br><span class="line">$-&gt; array([[  0.00000000e+00,  -2.22044605e-17,   1.11022302e-17,</span><br><span class="line">              <span class="number">8.88178420e-17</span>],</span><br><span class="line">           [ <span class="number">-2.22044605e-17</span>,  <span class="number">-1.11022302e-17</span>,  <span class="number">-7.77156117e-17</span>,</span><br><span class="line">              <span class="number">2.77555756e-17</span>],</span><br><span class="line">           [  <span class="number">2.22044605e-17</span>,  <span class="number">-5.55111512e-18</span>,  <span class="number">-3.33066907e-17</span>,</span><br><span class="line">             <span class="number">-6.66133815e-17</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过广播设置数组的值</span></span><br><span class="line">arr = randn(<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">arr[:] = <span class="number">5</span></span><br><span class="line">arr $-&gt;</span><br><span class="line">array([[ <span class="number">5.</span>,  <span class="number">5.</span>,  <span class="number">5.</span>,  <span class="number">5.</span>],</span><br><span class="line">       [ <span class="number">5.</span>,  <span class="number">5.</span>,  <span class="number">5.</span>,  <span class="number">5.</span>],</span><br><span class="line">       [ <span class="number">5.</span>,  <span class="number">5.</span>,  <span class="number">5.</span>,  <span class="number">5.</span>]])</span><br></pre></td></tr></table></figure>
<h5 id="ufunc高级应用"><a href="#ufunc高级应用" class="headerlink" title="ufunc高级应用"></a>ufunc高级应用</h5><center>ufunc方法</center>

<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">method</th>
<th style="text-align:center">explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">reduce(x)</td>
<td style="text-align:center">通过连续执行原始运算的方式对值进行聚合</td>
</tr>
<tr>
<td style="text-align:center">accumulate(x)</td>
<td style="text-align:center">聚合值，保留所有局部聚合结果</td>
</tr>
<tr>
<td style="text-align:center">reduceat(x,bin)</td>
<td style="text-align:center">局部约简。约简数据的各个切片以产生聚合型数组</td>
</tr>
<tr>
<td style="text-align:center">outer(x,y)</td>
<td style="text-align:center">对x、y中的每个元素应用原始运算</td>
</tr>
</tbody>
</table>
</div>
<h6 id="自定义ufunc"><a href="#自定义ufunc" class="headerlink" title="自定义ufunc"></a>自定义ufunc</h6><ul>
<li>numpy.frompyfunc()函数接受一个python函数，以及两个分别表示输入输出参数数量的整数</li>
<li>numpy.vectorize()函数用法类似</li>
<li>这两个函数速度较慢</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_elements</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x+y</span><br><span class="line"><span class="comment"># add_elements函数接受两个参数，返回一个参数</span></span><br><span class="line">add_them = np.frompyfunc(add_elements, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">add_them(np.arange(<span class="number">6</span>), np.arange(<span class="number">6</span>))</span><br><span class="line">$-&gt; array([0, 2, 4, 6, 8, 10], dtype=object)</span><br><span class="line"></span><br><span class="line">add_them = np.vectorize(add_elements)</span><br><span class="line">add_them(np.arange(<span class="number">6</span>), np.arange(<span class="number">6</span>))</span><br><span class="line">$-&gt; array([ 0,  2,  4,  6,  8, 10])</span><br></pre></td></tr></table></figure>
<h5 id="更多的排序"><a href="#更多的排序" class="headerlink" title="更多的排序"></a>更多的排序</h5><ul>
<li>ndarray的排序是就地排序</li>
<li>numpy.sort产生一个排好序的副本</li>
<li>两个函数都可以接受axis参数，0：对列排序，1：对行排序</li>
</ul>
<h6 id="间接排序"><a href="#间接排序" class="headerlink" title="间接排序"></a>间接排序</h6><p>对多个键排序时，可以使用这两个函数<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">values = np.array([<span class="number">5</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>])</span><br><span class="line">index = values.argsort()</span><br><span class="line">index</span><br><span class="line">$-&gt; array([1, 2, 4, 3, 0])</span><br><span class="line">values[index]</span><br><span class="line">$-&gt; array([0, 1, 2, 3, 5])</span><br><span class="line"></span><br><span class="line">first = np.array([<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>])</span><br><span class="line">last = np.array([<span class="string">'z'</span>,<span class="string">'y'</span>,<span class="string">'x'</span>,<span class="string">'v'</span>,<span class="string">'u'</span>])</span><br><span class="line"><span class="comment"># 键的应用是从后往前，先last，再first</span></span><br><span class="line">sorter = np.lexsort((first, last))</span><br><span class="line">sorter $-&gt; array([4, 3, 2, 1, 0])</span><br><span class="line"></span><br><span class="line">zip(last[sorter], first[sorter])</span><br><span class="line">$-&gt; [('u', 'e'), ('v', 'd'), ('x', 'c'), ('y', 'b'), ('z', 'a')]</span><br></pre></td></tr></table></figure></p>
<center>排序算法的kind参数</center>

<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">param</th>
<th style="text-align:center">speed</th>
<th style="text-align:center">stability</th>
<th style="text-align:center">space complexity</th>
<th style="text-align:center">worst complexity</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">quicksort</td>
<td style="text-align:center">1</td>
<td style="text-align:center">no</td>
<td style="text-align:center">0</td>
<td style="text-align:center">O(n^2)</td>
</tr>
<tr>
<td style="text-align:center">mergesort</td>
<td style="text-align:center">2</td>
<td style="text-align:center">yes</td>
<td style="text-align:center">n/2</td>
<td style="text-align:center">O(nlogn)</td>
</tr>
<tr>
<td style="text-align:center">heapsort</td>
<td style="text-align:center">3</td>
<td style="text-align:center">no</td>
<td style="text-align:center">0</td>
<td style="text-align:center">O(nlogn)</td>
</tr>
</tbody>
</table>
</div>
<h6 id="numpy-searchsorted"><a href="#numpy-searchsorted" class="headerlink" title="numpy.searchsorted"></a>numpy.searchsorted</h6><ul>
<li>有序数组中的查找，使用二分查找</li>
<li>存在待查找的元素，返回其序号，否则返回插入该元素后该元素的序号</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">arr = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">9</span>])</span><br><span class="line">arr.searchsorted(<span class="number">5</span>)</span><br><span class="line">$-&gt; 3</span><br><span class="line">arr.searchsorted(<span class="number">7</span>)</span><br><span class="line">$-&gt; 5</span><br><span class="line"></span><br><span class="line">arr = np.array([<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>])</span><br><span class="line">arr.searchsorted([<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line">$-&gt; array([0, 3])</span><br><span class="line"><span class="comment"># 从右边数</span></span><br><span class="line">arr.searchsorted([<span class="number">0</span>,<span class="number">1</span>], side=<span class="string">'right'</span>)</span><br><span class="line">$-&gt; array([3, 6])</span><br></pre></td></tr></table></figure>
<h5 id="NumPy的matrix类"><a href="#NumPy的matrix类" class="headerlink" title="NumPy的matrix类"></a>NumPy的matrix类</h5><ul>
<li>np.matrix()接受参数：二维数组，构建一个矩阵对象</li>
<li>支持使用直接的 * 运算</li>
<li>X.I返回矩阵X的逆</li>
<li>可用X.asarray将其转化为正规的ndarray对象</li>
</ul>
<h5 id="输出输入"><a href="#输出输入" class="headerlink" title="输出输入"></a>输出输入</h5><h6 id="内存映像文件"><a href="#内存映像文件" class="headerlink" title="内存映像文件"></a>内存映像文件</h6><ul>
<li>内存映像文件是一种将磁盘上的非常大的二进制文件当作文件中的数组进行处理的方式，实际上就是放在磁盘上的ndarray</li>
<li>NumPy中的memmap对象允许将大文件分成小段进行读写</li>
<li>np.memmap()函数接受(文件路径,数据类型,文件模式,模式)</li>
<li>对memmap对象切片会返回磁盘上的数据视图，如果对这些视图赋值，数据会被存储在内存中，调用flush就可以写入磁盘</li>
<li>如果某个内存映像超出作用域，他就会被垃圾回收器回收，之前的修改都会被写入磁盘</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mmap = memmap(<span class="string">'mymmap'</span>, dtype=<span class="string">'float64'</span>, mode=<span class="string">'w+'</span>, shape=(<span class="number">10000</span>,<span class="number">10000</span>))</span><br><span class="line">section = mmap[:<span class="number">5</span>]</span><br><span class="line">section[:] = randn(<span class="number">5</span>,<span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">mmap.flush()</span><br><span class="line"><span class="keyword">del</span> mmap</span><br></pre></td></tr></table></figure>
<h6 id="HDF5"><a href="#HDF5" class="headerlink" title="HDF5"></a>HDF5</h6><ul>
<li>PyTables和h5py用于处理高效、可压缩的HDF5格式的数据</li>
<li>PyTables提供了一些用于结构化数组的高级查询功能</li>
</ul>
<h5 id="性能加速"><a href="#性能加速" class="headerlink" title="性能加速"></a>性能加速</h5><ul>
<li>避免复制</li>
<li>使用广播</li>
<li>使用ufunc方法</li>
<li>使用连续内存</li>
<li>Cython加速</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr_c = np.ones((<span class="number">1000</span>,<span class="number">1000</span>), order=<span class="string">'C'</span>)</span><br><span class="line">arr_f = np.ones((<span class="number">1000</span>,<span class="number">1000</span>), order=<span class="string">'F'</span>)</span><br><span class="line"><span class="comment"># 对前者的操作要快于后者的操作，前者数据按照C语言的连续方式存储</span></span><br></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="atlantic8.github.io/2016/08/15/NumPy进阶/" data-id="ck66fynzn006j0wphcn8oqwz9" class="article-share-link"><i class="fas fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-Count-Complete-Tree-Nodes" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/07/19/Count-Complete-Tree-Nodes/">Count Complete Tree Nodes</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2016/07/19/Count-Complete-Tree-Nodes/">
            <time datetime="2016-07-19T08:21:35.000Z" itemprop="datePublished">2016-07-19</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/OJ/">OJ</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Binary-Tree/">Binary Tree</a>, <a class="tag-link" href="/tags/LeetCode/">LeetCode</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h3><p>count the total number of Binary Complete Tree nodes</p>
<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><ul>
<li><p>traverse tree skill is not acceptable.</p>
</li>
<li><p>The height of a tree can be found by just going left. Let a single node tree have height 0. Find the height h of the whole tree. If the whole tree is empty, i.e., has height -1, there are 0 nodes.</p>
</li>
<li><p>Otherwise check whether the height of the right subtree is just one less than that of the whole tree, meaning left and right subtree have the same height.</p>
</li>
<li><p>If yes, then the last node on the last tree row is in the right subtree and the left subtree is a full tree of height h-1. So we take the 2^h-1 nodes of the left subtree plus the 1 root node plus recursively the number of nodes in the right subtree.</p>
</li>
<li><p>If no, then the last node on the last tree row is in the left subtree and the right subtree is a full tree of height h-2. So we take the 2^(h-1)-1 nodes of the right subtree plus the 1 root node plus recursively the number of nodes in the left subtree.</p>
</li>
<li><p>Since I halve the tree in every recursive step, I have O(log(n)) steps. Finding a height costs O(log(n)). So overall O(log(n)^2).</p>
</li>
</ul>
<p>recursive version:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">height</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> root == <span class="keyword">null</span> ? -<span class="number">1</span> : <span class="number">1</span> + height(root.left);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countNodes</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> h = height(root);</span><br><span class="line">        <span class="keyword">return</span> h &lt; <span class="number">0</span> ? <span class="number">0</span> :</span><br><span class="line">               height(root.right) == h-<span class="number">1</span> ? (<span class="number">1</span> &lt;&lt; h) + countNodes(root.right)</span><br><span class="line">                                         : (<span class="number">1</span> &lt;&lt; h-<span class="number">1</span>) + countNodes(root.left);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>iterative version:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">countNodes</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!root) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> num=<span class="number">1</span>;</span><br><span class="line">        TreeNode *curR(root-&gt;left), *curL(root-&gt;left);</span><br><span class="line">        <span class="comment">// curR is the rightmost edge, which has a height equal to or less than the leftmost edge</span></span><br><span class="line">        <span class="keyword">while</span>(curR) &#123;</span><br><span class="line">            curL = curL-&gt;left;</span><br><span class="line">            curR = curR-&gt;right;</span><br><span class="line">            num = num&lt;&lt;<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  num + ( (!curL)?countNodes(root-&gt;right):countNodes(root-&gt;left) );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="atlantic8.github.io/2016/07/19/Count-Complete-Tree-Nodes/" data-id="ck66fynw300180wphne0pfanh" class="article-share-link"><i class="fas fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-Combination-Sum" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/07/19/Combination-Sum/">Combination Sum</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2016/07/19/Combination-Sum/">
            <time datetime="2016-07-19T07:20:12.000Z" itemprop="datePublished">2016-07-19</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/OJ/">OJ</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Backtracking/">Backtracking</a>, <a class="tag-link" href="/tags/LeetCode/">LeetCode</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="Problem-1-Combination-Sum"><a href="#Problem-1-Combination-Sum" class="headerlink" title="Problem 1 : Combination Sum"></a>Problem 1 : Combination Sum</h3><p>Given a set of candidate numbers (C) and a target number (T), find all unique combinations in C where the candidate numbers sums to T.<br><b>The same repeated number may be chosen from C unlimited number of times.</b></p>
<p>Note:</p>
<ul>
<li>All numbers (including target) will be positive integers.</li>
<li>The solution set must not contain duplicate combinations.</li>
</ul>
<p>For example, given candidate set [2, 3, 6, 7] and target 7,<br>A solution set is:<br>[ [7], [2, 2, 3] ]</p>
<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>the solution is: use recursive way , the function in the code following:</p>
<ul>
<li>recursive(vector<vector<int> &gt; &amp;results,vector<int> &amp;candidates, int target, int index, vector<int> res);</int></int></vector<int></li>
<li>results indicates the final results we want, index indicates the position where we start from, where res is a temp vector containing one solution of all.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="keyword">int</span>&gt; &gt; combinationSum(vector&lt;<span class="keyword">int</span>&gt; &amp;candidates, <span class="keyword">int</span> target) &#123;</span><br><span class="line">        vector&lt;vector&lt;<span class="keyword">int</span>&gt; &gt; results;</span><br><span class="line">        sort(candidates.begin(),candidates.end());  <span class="comment">//sort to fit the requirement of non-descending orde.</span></span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; res;</span><br><span class="line">        recursive(results,candidates,target,<span class="number">0</span>,res); <span class="comment">//we start from index 0</span></span><br><span class="line">        <span class="keyword">return</span> results;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">recursive</span><span class="params">(vector&lt;vector&lt;<span class="keyword">int</span>&gt; &gt; &amp;results,vector&lt;<span class="keyword">int</span>&gt; &amp;candidates, <span class="keyword">int</span> target, <span class="keyword">int</span> index, vector&lt;<span class="keyword">int</span>&gt; res)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (target == <span class="number">0</span>) &#123;   <span class="comment">//a valid solution is achieved</span></span><br><span class="line">            results.push_back(res);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=index; i&lt;candidates.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (target-candidates.at(i) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                vector&lt;<span class="keyword">int</span>&gt; temp = res;</span><br><span class="line">                temp.push_back(candidates.at(i));</span><br><span class="line">                <span class="comment">////new target, new temp vector,index is i because same candidate is allowed to be used in unlimitde times.</span></span><br><span class="line">                recursive(results,candidates,target-candidates.at(i),i,temp); </span><br><span class="line">            &#125; <span class="keyword">else</span>     <span class="comment">//if current sum is bigger than target, then adding bigger candidates is useless</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Problem-2-Combination-Sum-II"><a href="#Problem-2-Combination-Sum-II" class="headerlink" title="Problem 2 : Combination Sum II"></a>Problem 2 : Combination Sum II</h3><p>Given a collection of candidate numbers (C) and a target number (T), find all unique combinations in C where the candidate numbers sums to T.<br><b>Each number in C may only be used once in the combination.</b></p>
<p>Note:<br>All numbers (including target) will be positive integers.<br>The solution set must not contain duplicate combinations.<br>For example, given candidate set [10, 1, 2, 7, 6, 1, 5] and target 8,<br>A solution set is:<br>[ [1, 7], [1, 2, 5], [2, 6], [1, 1, 6] ]</p>
<h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h3><ul>
<li>difference between Combination Sum and Combination Sum II is “Each number in C may only be used once in the combination”</li>
<li>so we recursively use the function: recursive(vector<vector<int> &gt; &amp;results,vector<int> &amp;candidates, int target, int index, vector<int> res);</int></int></vector<int></li>
<li>i should start from index+1 to avoid duplication, the others are all the same.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; combinationSum2(<span class="keyword">int</span>[] cand, <span class="keyword">int</span> target) &#123;</span><br><span class="line">    Arrays.sort(cand);</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> ArrayList&lt;List&lt;Integer&gt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; path = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">    dfs_com(cand, <span class="number">0</span>, target, path, res);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs_com</span><span class="params">(<span class="keyword">int</span>[] cand, <span class="keyword">int</span> cur, <span class="keyword">int</span> target, List&lt;Integer&gt; path, List&lt;List&lt;Integer&gt;&gt; res)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (target == <span class="number">0</span>) &#123;</span><br><span class="line">        res.add(<span class="keyword">new</span> ArrayList(path));</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (target &lt; <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = cur; i &lt; cand.length; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; cur &amp;&amp; cand[i] == cand[i-<span class="number">1</span>]) <span class="keyword">continue</span>;</span><br><span class="line">        path.add(path.size(), cand[i]);</span><br><span class="line">        dfs_com(cand, i+<span class="number">1</span>, target - cand[i], path, res);</span><br><span class="line">        path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Problem-3-Combination-Sum-III"><a href="#Problem-3-Combination-Sum-III" class="headerlink" title="Problem 3 : Combination Sum III"></a>Problem 3 : Combination Sum III</h3><p>Find all possible <b>combinations of k numbers</b> that add up to a number n, given that only numbers from 1 to 9 can be used and each combination should be a unique set of numbers.</p>
<p>Example 1:<br>Input: k = 3, n = 7<br>Output:<br>[[1,2,4]]</p>
<p>Example 2:<br>Input: k = 3, n = 9<br>Output:<br>[[1,2,6], [1,3,5], [2,3,4]]</p>
<h3 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h3><p>control the number of integers used.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="comment"># @param &#123;integer&#125; k</span></span><br><span class="line">    <span class="comment"># @param &#123;integer&#125; n</span></span><br><span class="line">    <span class="comment"># @return &#123;integer[][]&#125;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.ret=[]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">combinationSum3</span><span class="params">(self, k, n)</span>:</span></span><br><span class="line">        self.findTuple(k, n, [], <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> self.ret</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findTuple</span><span class="params">(self, k, n, tmp, start)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> k&lt;<span class="number">0</span> <span class="keyword">or</span> n&lt;<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> k==<span class="number">0</span> <span class="keyword">and</span> n==<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> sorted(tmp) <span class="keyword">not</span> <span class="keyword">in</span> self.ret:</span><br><span class="line">                self.ret.append(sorted(tmp))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">for</span> cand <span class="keyword">in</span> range(start, <span class="number">10</span>):</span><br><span class="line">            <span class="keyword">if</span> cand&gt;n:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> cand <span class="keyword">not</span> <span class="keyword">in</span> tmp <span class="keyword">and</span> cand&lt;=n:</span><br><span class="line">                temp = copy.deepcopy(tmp)</span><br><span class="line">                temp.append(cand)</span><br><span class="line">                self.findTuple(k<span class="number">-1</span>, n-cand, temp, cand+<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Problem-4-Combination-Sum-IV"><a href="#Problem-4-Combination-Sum-IV" class="headerlink" title="Problem 4 : Combination Sum IV"></a>Problem 4 : Combination Sum IV</h3><p>Given an integer array with all <strong>positive numbers and no duplicates</strong>, find the number of possible combinations that add up to a positive integer target.</p>
<pre><code>nums = [1, 2, 3]
target = 4

The possible combination ways are:
(1, 1, 1, 1)
(1, 1, 2)
(1, 2, 1)
(1, 3)
(2, 1, 1)
(2, 2)
(3, 1)
</code></pre><p>Note that different sequences are counted as different combinations.</p>
<p>Therefore the output is 7.</p>
<h4 id="Solution-3"><a href="#Solution-3" class="headerlink" title="Solution"></a>Solution</h4><p>这是一个DP题，如果简单使用统计的方法可能会超时。</p>
<pre><code>comb[target] = sum(comb[target - nums[i]]), where 0 &lt;= i &lt; nums.length, and target &gt;= nums[i]
</code></pre><p>代码为<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">combinationSum4</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] comb = <span class="keyword">new</span> <span class="keyword">int</span>[target + <span class="number">1</span>];</span><br><span class="line">    comb[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; comb.length; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; nums.length; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i - nums[j] &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                comb[i] += comb[i - nums[j]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> comb[target];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="atlantic8.github.io/2016/07/19/Combination-Sum/" data-id="ck66fynvr000v0wph0imfceah" class="article-share-link"><i class="fas fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-Binary-Tree-Maximum-Path-Sum" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/07/19/Binary-Tree-Maximum-Path-Sum/">Binary Tree Maximum Path Sum</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2016/07/19/Binary-Tree-Maximum-Path-Sum/">
            <time datetime="2016-07-19T07:01:56.000Z" itemprop="datePublished">2016-07-19</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/OJ/">OJ</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Binary-Tree/">Binary Tree</a>, <a class="tag-link" href="/tags/LeetCode/">LeetCode</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h3><p>Given a binary tree, find the maximum path sum.</p>
<p>For this problem, a path is defined as any sequence of nodes from some starting node to any node in the tree along the parent-child connections. The path does not need to go through the root.</p>
<p>For example:<br>Given the below binary tree,</p>
<pre><code>   1
  / \
 2   3
</code></pre><p>Return 6.</p>
<h5 id="Original-Address"><a href="#Original-Address" class="headerlink" title="Original Address"></a><a href="https://leetcode.com/problems/binary-tree-maximum-path-sum/" target="_blank" rel="noopener">Original Address</a></h5><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>function getMaxRoot(r) compute max value edged with node r<br>also, r is the highest node. for example:</p>
<pre><code>   1
  / \
 2   3
</code></pre><p>getMaxRoot(1) returns 4.<br>each path has a highest node.<br>for a single node:<br>    maxPrice = max(maxPrice, getMaxRoot(r-&gt;left)+getMaxRoot(r-&gt;right)+r-&gt;val);<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> maxPrice;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxPathSum</span><span class="params">(TreeNode *root)</span> </span>&#123;</span><br><span class="line">        maxPrice=INT_MIN;</span><br><span class="line">        getMaxRoot(root);</span><br><span class="line">        <span class="keyword">return</span> maxPrice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// compute the maximum value of the path with hightest and edge node r.</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getMaxRoot</span><span class="params">(TreeNode *r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (r == NULL)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">           <span class="keyword">int</span> leftM  = max(<span class="number">0</span>,getMaxRoot(r-&gt;left));</span><br><span class="line">        <span class="keyword">int</span> rightM = max(<span class="number">0</span>,getMaxRoot(r-&gt;right));  </span><br><span class="line">        maxPrice = max(maxPrice, leftM+rightM+r-&gt;val);</span><br><span class="line">        <span class="keyword">return</span> max(leftM,rightM)+r-&gt;val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="atlantic8.github.io/2016/07/19/Binary-Tree-Maximum-Path-Sum/" data-id="ck66fynvb000g0wphprs115mq" class="article-share-link"><i class="fas fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-Best-Time-to-Buy-and-Sell-Stock" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/07/19/Best-Time-to-Buy-and-Sell-Stock/">Best Time to Buy and Sell Stock</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2016/07/19/Best-Time-to-Buy-and-Sell-Stock/">
            <time datetime="2016-07-19T06:32:38.000Z" itemprop="datePublished">2016-07-19</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/OJ/">OJ</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/DP/">DP</a>, <a class="tag-link" href="/tags/Greedy/">Greedy</a>, <a class="tag-link" href="/tags/LeetCode/">LeetCode</a>, <a class="tag-link" href="/tags/State-Machine/">State Machine</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="Problem-Time-to-Buy-and-Sell-Stock-II"><a href="#Problem-Time-to-Buy-and-Sell-Stock-II" class="headerlink" title="Problem : Time to Buy and Sell Stock II"></a>Problem : Time to Buy and Sell Stock II</h3><p>Say you have an array for which the ith element is the price of a given stock on day i.</p>
<p>Design an algorithm to find the maximum profit. You may complete <b>as many transactions as you like</b> (ie, buy one and sell one share of the stock multiple times). However, you may not engage in multiple transactions at the same time (ie, you must sell the stock before you buy again).</p>
<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p><b>贪心算法</b>：条件是假设一天内卖完了可以再买，1-2-3可以拆分成1-2和2-3.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt; prices.length-<span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prices[i+<span class="number">1</span>]&gt;prices[i]) total += prices[i+<span class="number">1</span>]-prices[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果不允许在一天内卖完了可以再买，贪心的算法是没有意义的，虽然答案是对的。<br>这时，每一次需要找到local最小值和local最大值，然后把差值加到返回值上。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> profit = <span class="number">0</span>, i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; prices.length) &#123;</span><br><span class="line">        <span class="comment">// 找到local最小值</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; prices.length-<span class="number">1</span> &amp;&amp; prices[i+<span class="number">1</span>] &lt;= prices[i]) i++;</span><br><span class="line">        <span class="keyword">int</span> min = prices[i++]; <span class="comment">// 因为price[i+1]&gt;price[i]，所以将i++</span></span><br><span class="line">        <span class="comment">// 找到local最大值</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; prices.length-<span class="number">1</span> &amp;&amp; prices[i+<span class="number">1</span>] &gt;= prices[i]) i++;</span><br><span class="line">        profit += i &lt; prices.length ? prices[i++] - min : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> profit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Problem-Time-to-Buy-and-Sell-Stock-III"><a href="#Problem-Time-to-Buy-and-Sell-Stock-III" class="headerlink" title="Problem : Time to Buy and Sell Stock III"></a>Problem : Time to Buy and Sell Stock III</h3><p>Say you have an array for which the ith element is the price of a given stock on day i.</p>
<p>Design an algorithm to find the maximum profit. You may complete at most two transactions.</p>
<p>Note:<br>You may not engage in multiple transactions at the same time (ie, you must sell the stock before you buy again).</p>
<h5 id="Original-Address"><a href="#Original-Address" class="headerlink" title="Original Address"></a><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iii/" target="_blank" rel="noopener">Original Address</a></h5><h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h3><p>依旧是DP问题，如果用a[i][j]表示从标号i到j单次最大的利润，代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = prices.length;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span>[][] minElement=<span class="keyword">new</span> <span class="keyword">int</span>[n][n], maxpay=<span class="keyword">new</span> <span class="keyword">int</span>[n][n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++) &#123;</span><br><span class="line">        minElement[i][i] = prices[i];</span><br><span class="line">        maxpay[i][i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> len=<span class="number">1</span>; len&lt;n; len++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i+len&lt;n; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> j = i+len;</span><br><span class="line">            <span class="keyword">if</span> (prices[i]-minElement[i][j-<span class="number">1</span>] &gt; maxpay[i][j-<span class="number">1</span>])</span><br><span class="line">                maxpay[i][j] = prices[i]-minElement[i][j-<span class="number">1</span>];</span><br><span class="line">            minElement[i][j] = Math.min(prices[j], minElement[i][j-<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> div = <span class="number">2</span>, maxprofit = maxpay[<span class="number">0</span>][n-<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">return</span> maxprofit;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=div; i&lt;n-<span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> x1 = maxpay[<span class="number">0</span>][i];</span><br><span class="line">        <span class="keyword">int</span> x2 = maxpay[i][n-<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (x1+x2 &gt; maxprofit)</span><br><span class="line">            maxprofit = x1+x2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> maxprofit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>但是，这样时间复杂度为O(n^2)。TLE！！！！！！！！！<br>然后参考了别人的思路：——————————————-<br><b><br>以f[k][i]表示第k个transaction后从开始到标号i-1得到的最大利润<br>迭代方程要考虑两种情况：</b></p>
<ol>
<li>p[i]不比前一个售出点的price高，所以f[k][i]=f[k][i-1]</li>
<li>p[i]  比前一个售出点的price高，所以f[k][i]=max{f[k-1][j]+p[i]-p[j]}=p[i]+max{f[k-1][j]-p[j]} (其中1&lt;j&lt;i-1)</li>
</ol>
<p>所以，f[k][i] = max{f[k][i-1], max{f[k-1][j]+p[i]-p[j]} }<br>问题来了，如果这么实现，复杂度又会达到O(n^2).<br>注意到情况2中的“ max{f[k-1][j]-p[j]} ”，可以使用一个变量记录最大的f[k-1][j]-p[j]，然后每次更新它即可<br>对于每个transaction循环，它的初始值为：tmp = maxpay[k-1][0]-p[0], 每到一个新的i，更新tmp=max{tmp, f[k-1][i]-p[i])。<br>所以迭代方程就可以写成：f[k][i]=p[i]+tmp. 这样，时间复杂度就降到了O(n). &lt;/b&gt;<br>本题也可以变形为至多执行k个transaction，只需要把代码中2,3改成k,k+1即可。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = prices.length;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// maxpay[t][i] indicates the max profit in t-th transaction</span></span><br><span class="line">        <span class="keyword">int</span>[][] maxpay=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][n];</span><br><span class="line">        <span class="comment">// initialize maxpay, when t=0, maxpay[t][i]=0</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">3</span>; j++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++)</span><br><span class="line">                maxpay[j][i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> t=<span class="number">1</span>; t&lt;<span class="number">3</span>; t++) &#123;</span><br><span class="line">            <span class="comment">// for every t, initialize t</span></span><br><span class="line">            <span class="keyword">int</span> tmp = maxpay[t-<span class="number">1</span>][<span class="number">0</span>]-prices[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;n; i++) &#123;</span><br><span class="line">                <span class="comment">//iteration formula</span></span><br><span class="line">                <span class="comment">//maxpay[t][i] = Math.max&#123; maxpay[t][i-1] , prices[i]+max&lt;j&gt;&#123;maxpay[t-1][j]-prices[j]&#125; &#125;;</span></span><br><span class="line">                maxpay[t][i] = Math.max(maxpay[t][i-<span class="number">1</span>], prices[i]+tmp);</span><br><span class="line">                <span class="comment">// make sure that tmp = max(tmp , maxpay[t-1][i]-prices[i])</span></span><br><span class="line">                tmp = Math.max(tmp, maxpay[t-<span class="number">1</span>][i]-prices[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxpay[<span class="number">2</span>][n-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Problem-Time-to-Buy-and-Sell-Stock-IV"><a href="#Problem-Time-to-Buy-and-Sell-Stock-IV" class="headerlink" title="Problem : Time to Buy and Sell Stock IV"></a>Problem : Time to Buy and Sell Stock IV</h3><p>Say you have an array for which the ith element is the price of a given stock on day i.</p>
<p>Design an algorithm to find the maximum profit. You may complete at most k transactions.</p>
<p>Note:<br>You may not engage in multiple transactions at the same time (ie, you must sell the stock before you buy again).</p>
<h5 id="Original-Address-1"><a href="#Original-Address-1" class="headerlink" title="Original Address"></a><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iv/" target="_blank" rel="noopener">Original Address</a></h5><h3 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h3><p>we are allowed to perform at most k transactions<br>we can apply the algorithm above, but there is one thing to notice,<br>    when k is very large: k&gt;=n/2, that’s to say, we perform one transaction on each day.<br>    so, the problem becomes Best Time to Buy and Sell Stock II,<br>    greedy algorithm is ok, otherwise we get TLE.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span>[] prices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = prices.length;</span><br><span class="line">        <span class="keyword">if</span> (k &gt;= len / <span class="number">2</span>) <span class="keyword">return</span> quickSolve(prices);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span>[][] t = <span class="keyword">new</span> <span class="keyword">int</span>[k + <span class="number">1</span>][len];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> tmpMax =  -prices[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; len; j++) &#123;</span><br><span class="line">                t[i][j] = Math.max(t[i][j - <span class="number">1</span>], prices[j] + tmpMax);</span><br><span class="line">                tmpMax =  Math.max(tmpMax, t[i - <span class="number">1</span>][j - <span class="number">1</span>] - prices[j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> t[k][len - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">quickSolve</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = prices.length, profit = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; len; i++)</span><br><span class="line">            <span class="comment">// as long as there is a price gap, we gain a profit.</span></span><br><span class="line">            <span class="keyword">if</span> (prices[i] &gt; prices[i - <span class="number">1</span>]) profit += prices[i] - prices[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">return</span> profit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Problem-Best-Time-to-Buy-and-Sell-Stock-with-Cooldown"><a href="#Problem-Best-Time-to-Buy-and-Sell-Stock-with-Cooldown" class="headerlink" title="Problem : Best Time to Buy and Sell Stock with Cooldown"></a>Problem : Best Time to Buy and Sell Stock with Cooldown</h3><p>Say you have an array for which the ith element is the price of a given stock on day i.</p>
<p>Design an algorithm to find the maximum profit. You may complete as many transactions as you like (ie, buy one and sell one share of the stock multiple times) with the following restrictions:</p>
<p>You may not engage in multiple transactions at the same time (ie, you must sell the stock before you buy again).<br><b>After you sell your stock, you cannot buy stock on next day. (ie, cooldown 1 day)</b></p>
<pre><code>Example:

prices = [1, 2, 3, 0, 2]
maxProfit = 3
transactions = [buy, sell, cooldown, buy, sell]
</code></pre><h3 id="Solution-3"><a href="#Solution-3" class="headerlink" title="Solution"></a>Solution</h3><p>本题中，可能的操作有buy、sell、rest(啥也不干)。可以使用状态机来解题：<br>由题可以绘制如下状态机：<br><img src="http://ww4.sinaimg.cn/mw690/9bcfe727jw1f7xj05lgqrj20e20710t1.jpg" alt=""><br>转移方程表示如下：</p>
<pre><code>s0[i] = max(s0[i - 1], s2[i - 1]);
s1[i] = max(s1[i - 1], s0[i - 1] - prices[i]);
s2[i] = s1[i - 1] + prices[i];
</code></pre><p>由于s1状态是买完以后的状态，所以最值最大值肯定不在s1上出现，只要找到最大的s0和s2.<br>关于初值设置：</p>
<ul>
<li>s0=0，因为如果以s0为开始，你没有任何股票</li>
<li>如果以s1为开始，通过buy第一天的股票获得，可以设置s1的初值为-price[0]</li>
<li>设置s2的初值为INT_MIN，当然设置为0也完全没有问题(没有股票卖也卖不到钱)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; prices)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (prices.size() &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">s0</span><span class="params">(prices.size()</span>, 0)</span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">s1</span><span class="params">(prices.size()</span>, 0)</span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">s2</span><span class="params">(prices.size()</span>, 0)</span>;</span><br><span class="line">        s1[<span class="number">0</span>] = -prices[<span class="number">0</span>];</span><br><span class="line">        s0[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        s2[<span class="number">0</span>] = INT_MIN;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; prices.size(); i++) &#123;</span><br><span class="line">            s0[i] = max(s0[i - <span class="number">1</span>], s2[i - <span class="number">1</span>]);</span><br><span class="line">            s1[i] = max(s1[i - <span class="number">1</span>], s0[i - <span class="number">1</span>] - prices[i]);</span><br><span class="line">            s2[i] = s1[i - <span class="number">1</span>] + prices[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max(s0[prices.size() - <span class="number">1</span>], s2[prices.size() - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>空间复杂度为O(n)，可以降低到O(1).</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (prices.size() &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> s0 = <span class="number">0</span>, s1 = -prices[<span class="number">0</span>], s2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; prices.size(); ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> last_s2 = s2;</span><br><span class="line">            s2 = s1 + prices[i];</span><br><span class="line">            s1 = max(s0 - prices[i], s1);</span><br><span class="line">            s0 = max(s0, last_s2);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max(s0, s2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="atlantic8.github.io/2016/07/19/Best-Time-to-Buy-and-Sell-Stock/" data-id="ck66fynuw00070wphzfhqdjiz" class="article-share-link"><i class="fas fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-python-visualization" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/07/10/python-visualization/">python visualization</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2016/07/10/python-visualization/">
            <time datetime="2016-07-10T14:12:11.000Z" itemprop="datePublished">2016-07-10</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/python/">python</a>, <a class="tag-link" href="/tags/visualization/">visualization</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="matplotlib"><a href="#matplotlib" class="headerlink" title="matplotlib"></a>matplotlib</h2><h4 id="matplotlib配置"><a href="#matplotlib配置" class="headerlink" title="matplotlib配置"></a>matplotlib配置</h4><ul>
<li>修改文件，位于.matplotlib目录中</li>
<li>使用rc方法,可以定义的有’figure’,’axes’,’xtick’,’ytick’,’grid’,’legend’等<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">plt.rc(<span class="string">'figure'</span>, figsize=(<span class="number">10</span>,<span class="number">10</span>)) <span class="comment"># 设置图像默认大小</span></span><br><span class="line"><span class="comment"># 也可以</span></span><br><span class="line">font_option = &#123;<span class="string">'family'</span>:<span class="string">'monospace'</span>,</span><br><span class="line">               <span class="string">'weight'</span>:<span class="string">'bold'</span>,</span><br><span class="line">               <span class="string">'size'</span>:<span class="string">'small'</span>&#125;</span><br><span class="line">plt.rc(<span class="string">'font'</span>, **font_option)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="matplotlib使用"><a href="#matplotlib使用" class="headerlink" title="matplotlib使用"></a>matplotlib使用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<p>创建一个新的figure，所有图像都位于Figure对象中<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.figure(<span class="number">2</span>)  <span class="comment"># 图像编号为2</span></span><br></pre></td></tr></table></figure></p>
<p>无法通过空的Figure绘图，必须用add_subplot()创建subplot<br>创建4个子图，2x2<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ax1 = fig.add_subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">ax2 = fig.add_subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">ax3 = fig.add_subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">fig.show() <span class="comment"># 显示</span></span><br></pre></td></tr></table></figure></p>
<p>分别对每个sub_figure画图<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ax1.plot(...)</span><br><span class="line">ax2.scatter(...)</span><br><span class="line">ax2.bar(...)</span><br><span class="line">fig.show()</span><br></pre></td></tr></table></figure></p>
<p>subplots，返回一个含有已创建subplot对象的numpy数组<br>axes可以使用axes[][]的形式访问<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fig, axes = plt.subplots(<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">axes</span><br><span class="line">$-&gt; array([[&lt;matplotlib.axes._subplots.AxesSubplot object at 0x0A8B2EF0&gt;,</span><br><span class="line">            &lt;matplotlib.axes._subplots.AxesSubplot object at <span class="number">0x0AA5F5D0</span>&gt;,</span><br><span class="line">            &lt;matplotlib.axes._subplots.AxesSubplot object at <span class="number">0x0AA9DD90</span>&gt;],</span><br><span class="line">           [&lt;matplotlib.axes._subplots.AxesSubplot object at <span class="number">0x0AAD1E70</span>&gt;,</span><br><span class="line">            &lt;matplotlib.axes._subplots.AxesSubplot object at <span class="number">0x0AB1B810</span>&gt;,</span><br><span class="line">            &lt;matplotlib.axes._subplots.AxesSubplot object at <span class="number">0x0697C130</span>&gt;]], dtype=object)</span><br></pre></td></tr></table></figure></p>
<p>subplots_adjust间距控制<br>wspace,hspace控制宽度和高度的百分比，可以用作subplot之间的距离<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.subplots_adjust(left=<span class="keyword">None</span>, bottom=<span class="keyword">None</span>, right=<span class="keyword">None</span>, top=<span class="keyword">None</span>, wspace=<span class="keyword">None</span>, hspace=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure></p>
<center><b>pyplot.subplots的选项</b></center>

<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">parameter</th>
<th style="text-align:center">explaination</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">nrows</td>
<td style="text-align:center">subplot的行数</td>
</tr>
<tr>
<td style="text-align:center">ncols</td>
<td style="text-align:center">subplot的列数</td>
</tr>
<tr>
<td style="text-align:center">sharex</td>
<td style="text-align:center">所有子图使用相同x轴刻度（xlim的影响）</td>
</tr>
<tr>
<td style="text-align:center">sharey</td>
<td style="text-align:center">所有子图使用相同y轴刻度（xlim的影响）</td>
</tr>
<tr>
<td style="text-align:center">subplot_kw</td>
<td style="text-align:center">用于创建各subplot的关键字字典</td>
</tr>
<tr>
<td style="text-align:center">**fig_kw</td>
<td style="text-align:center">创建fig时的其他关键字，如plt.subplot(2,2,figsize=(8,6))</td>
</tr>
</tbody>
</table>
</div>
<p>设置x、y轴的刻度<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ticks = axe1.set_xticks([<span class="number">0</span>,<span class="number">200</span>,<span class="number">400</span>,<span class="number">600</span>,<span class="number">800</span>])</span><br><span class="line"><span class="comment"># 旋转45读，字体大小为9</span></span><br><span class="line">labels = axe1.set_xtickslabels([<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'three'</span>,<span class="string">'four'</span>,<span class="string">'five'</span>],rotation=<span class="number">45</span>,fontsize=<span class="number">9</span>)</span><br><span class="line"><span class="comment"># 将图例放在不错的位置，自动选择</span></span><br><span class="line">ax.legend(loc=<span class="string">'best'</span>)</span><br></pre></td></tr></table></figure></p>
<p>注解，显示在(x,y)位置<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ax.text(x, y, <span class="string">'hello world'</span>, family=<span class="string">'consola'</span>, fontsize=<span class="number">10</span>)</span><br><span class="line"><span class="comment"># annotate函数注解，既有箭头又有文字</span></span><br><span class="line"><span class="comment"># xy是箭头位置，xytext是注解位置，结果如下图：</span></span><br><span class="line">ax.annotate(<span class="string">'local max'</span>, xy=(<span class="number">2</span>, <span class="number">1</span>), xytext=(<span class="number">3</span>, <span class="number">1.5</span>),</span><br><span class="line">            arrowprops=dict(facecolor=<span class="string">'black'</span>, shrink=<span class="number">0.05</span>),</span><br><span class="line">            )</span><br></pre></td></tr></table></figure></p>
<center>![](http://matplotlib.org/_images/annotation_basic.png)</center>

<p>图形中放入块patch<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rect = plt.Rectangle((<span class="number">0.2</span>,<span class="number">0.75</span>), <span class="number">0.4</span>, <span class="number">0.15</span>, color=<span class="string">'r'</span>, alpha=<span class="number">0.3</span>)</span><br><span class="line">circ = plt.Circle((<span class="number">0.7</span>,<span class="number">0.2</span>), <span class="number">0.15</span>, color=<span class="string">'b'</span>, alpha=<span class="number">0.3</span>)</span><br><span class="line">pgon = plt.Polygon([[<span class="number">0.15</span>,<span class="number">0.15</span>],[<span class="number">0.35</span>,<span class="number">0.4</span>],[<span class="number">0.2</span>,<span class="number">0.6</span>]], color=<span class="string">'g'</span>, alpha=<span class="number">0.3</span>)</span><br><span class="line"></span><br><span class="line">ax.add_patch(rect)</span><br><span class="line">ax.add_patch(circ)</span><br><span class="line">ax.add_patch(pgon)</span><br></pre></td></tr></table></figure></p>
<center><b>图形属性和说明</b></center>

<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">attribute</th>
<th style="text-align:center">explaination</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">color</td>
<td style="text-align:center">color=’g’ 颜色，可以指定’#555555’</td>
</tr>
<tr>
<td style="text-align:center">linestyle</td>
<td style="text-align:center">linestyle=’—‘ 线性</td>
</tr>
<tr>
<td style="text-align:center">marker</td>
<td style="text-align:center">marker=’o’ 标记</td>
</tr>
<tr>
<td style="text-align:center">label</td>
<td style="text-align:center">label=’algorithm 1’ 图例</td>
</tr>
<tr>
<td style="text-align:center">xlim,ylim</td>
<td style="text-align:center">x轴、y轴的范围</td>
</tr>
</tbody>
</table>
</div>
<p>保存文件，参数设置如下表<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.savefig()</span><br></pre></td></tr></table></figure></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">params</th>
<th style="text-align:center">introduction</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">fname</td>
<td style="text-align:center">文件名</td>
</tr>
<tr>
<td style="text-align:center">dpi</td>
<td style="text-align:center">分辨率（每英寸点数），默认为100</td>
</tr>
<tr>
<td style="text-align:center">facecolor、edgecolor</td>
<td style="text-align:center">背景色，默认为白色</td>
</tr>
<tr>
<td style="text-align:center">format</td>
<td style="text-align:center">设置文件格式，png、pdf等</td>
</tr>
<tr>
<td style="text-align:center">bbox_inches</td>
<td style="text-align:center">图标需要保存的部分。设为tight则尝试剪掉图标周围的空白部分</td>
</tr>
</tbody>
</table>
</div>
<h3 id="Pandas中的可视化方法"><a href="#Pandas中的可视化方法" class="headerlink" title="Pandas中的可视化方法"></a>Pandas中的可视化方法</h3><h4 id="普通的plot"><a href="#普通的plot" class="headerlink" title="普通的plot"></a>普通的plot</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> matplotlib</span><br><span class="line">matplotlib.style.use(<span class="string">'ggplot'</span>)</span><br><span class="line"></span><br><span class="line">ts = pd.Series(np.random.randn(<span class="number">1000</span>), index=pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">1000</span>))</span><br><span class="line">ts = ts.cumsum()</span><br><span class="line">ts.plot()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/series_plot_basic.png)</center>

<p><b>On DataFrame, plot() is a convenience to plot all of the columns with labels</b><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">1000</span>, <span class="number">4</span>), index=ts.index, columns=list(<span class="string">'ABCD'</span>))</span><br><span class="line">df = df.cumsum()</span><br><span class="line">df.plot()</span><br><span class="line">plt.show()</span><br><span class="line"><span class="comment"># 其他关键字 subplots=True将不同列的图分别画在子图中</span></span><br><span class="line"><span class="comment"># layout=(2, 3) 两行三列</span></span><br><span class="line"><span class="comment"># sharex=False，sharey=False -&gt; 不共享x、y轴</span></span><br></pre></td></tr></table></figure></p>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/frame_plot_basic.png)</center>

<p><b>You can plot one column versus another using the x and y keywords in plot()</b><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">df3 = pd.DataFrame(np.random.randn(<span class="number">1000</span>, <span class="number">2</span>), columns=[<span class="string">'B'</span>, <span class="string">'C'</span>]).cumsum()</span><br><span class="line">df3[<span class="string">'A'</span>] = pd.Series(list(range(len(df))))</span><br><span class="line">df3.plot(x=<span class="string">'A'</span>, y=<span class="string">'B'</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure></p>
<h5 id="使用第二个y轴"><a href="#使用第二个y轴" class="headerlink" title="使用第二个y轴"></a>使用第二个y轴</h5><p>使用secondary_y关键字<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">df.A.plot()</span><br><span class="line">df.B.plot(secondary_y=<span class="keyword">True</span>, style=<span class="string">'g'</span>)</span><br><span class="line"><span class="comment"># 或者    mark_right默认是True</span></span><br><span class="line">ax = df.plot(secondary_y=[<span class="string">'A'</span>, <span class="string">'B'</span>], mark_right=<span class="keyword">True</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">'CD scale'</span>)</span><br><span class="line">ax.right_ax.set_ylabel(<span class="string">'AB scale'</span>)</span><br></pre></td></tr></table></figure></p>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/frame_plot_secondary_y.png)</center>

<h5 id="Scales尺度"><a href="#Scales尺度" class="headerlink" title="Scales尺度"></a>Scales尺度</h5><p>使用logy、logx、loglog关键字<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ts = pd.Series(np.random.randn(<span class="number">1000</span>), index=pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">1000</span>))</span><br><span class="line">ts = np.exp(ts.cumsum())</span><br><span class="line">ts.plot(logy=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="其他plot，用kind指定"><a href="#其他plot，用kind指定" class="headerlink" title="其他plot，用kind指定"></a>其他plot，用kind指定</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">value</th>
<th style="text-align:center">function</th>
<th style="text-align:center">value</th>
<th style="text-align:center">function</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">bar</td>
<td style="text-align:center">直方图</td>
<td style="text-align:center">hist</td>
<td style="text-align:center">统计直方图</td>
</tr>
<tr>
<td style="text-align:center">kde, density</td>
<td style="text-align:center">密度图</td>
<td style="text-align:center">box</td>
<td style="text-align:center">盒须图</td>
</tr>
<tr>
<td style="text-align:center">area</td>
<td style="text-align:center">面积图</td>
<td style="text-align:center">scatter</td>
<td style="text-align:center">散点图</td>
</tr>
<tr>
<td style="text-align:center">hexbin</td>
<td style="text-align:center">六边形箱图</td>
<td style="text-align:center">pie</td>
<td style="text-align:center">饼图</td>
</tr>
<tr>
<td style="text-align:center">barh</td>
<td style="text-align:center">横向的直方图</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df.ix[<span class="number">5</span>].plot(kind=<span class="string">'bar'</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/bar_plot_ex.png)</center>

<p><b>其他用法</b><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame()</span><br><span class="line">$-&gt; df.plot.area    df.plot.box     df.plot.hist    df.plot.pie</span><br><span class="line">    df.plot.bar     df.plot.density df.plot.kde     df.plot.scatter</span><br><span class="line">    df.plot.barh    df.plot.hexbin  df.plot.line</span><br></pre></td></tr></table></figure></p>
<h5 id="bar-plot"><a href="#bar-plot" class="headerlink" title="bar plot"></a>bar plot</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">df.ix[<span class="number">5</span>].plot.bar()</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">df2 = pd.DataFrame(np.random.rand(<span class="number">10</span>, <span class="number">4</span>), columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">df2.plot.bar()</span><br><span class="line">df2.plot.bar(stacked=<span class="keyword">True</span>)  <span class="comment"># 堆叠式</span></span><br><span class="line">df2.plot.barh(stacked=<span class="keyword">True</span>)  <span class="comment"># 横向</span></span><br></pre></td></tr></table></figure>
<h5 id="histogram"><a href="#histogram" class="headerlink" title="histogram"></a>histogram</h5><p>Histogram can be drawn by using the <b>DataFrame.plot.hist()</b> and <b>Series.plot.hist()</b> methods<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df4 = pd.DataFrame(&#123;<span class="string">'a'</span>: np.random.randn(<span class="number">1000</span>) + <span class="number">1</span>, <span class="string">'b'</span>: np.random.randn(<span class="number">1000</span>),<span class="string">'c'</span>: np.random.randn(<span class="number">1000</span>) - <span class="number">1</span>&#125;, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line">df4.plot.hist(stacked=<span class="keyword">True</span>, bins=<span class="number">20</span>) <span class="comment"># 下图</span></span><br><span class="line">df4[<span class="string">'a'</span>].plot.hist(orientation=<span class="string">'horizontal'</span>, cumulative=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure></p>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/hist_new_stacked.png)</center>

<h5 id="Box盒须图"><a href="#Box盒须图" class="headerlink" title="Box盒须图"></a>Box盒须图</h5><p>Boxplot can be drawn calling <b>Series.plot.box()</b> and <b>DataFrame.plot.box()</b>, or <b>DataFrame.boxplot()</b> to visualize the distribution of values within each column<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(np.random.rand(<span class="number">10</span>, <span class="number">5</span>), columns=[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>])</span><br><span class="line"><span class="comment"># 设置不同区域的颜色</span></span><br><span class="line">color = dict(boxes=<span class="string">'DarkGreen'</span>, whiskers=<span class="string">'DarkOrange'</span>, medians=<span class="string">'DarkBlue'</span>, caps=<span class="string">'Gray'</span>)</span><br><span class="line"><span class="comment"># sym keyword, vert表示是否横向显示</span></span><br><span class="line"><span class="comment"># 另外还有positions=[1, 4, 5, 6, 8]参数指示盒图的位置</span></span><br><span class="line">df.plot.box(color=color, sym=<span class="string">'r+'</span>, vert=<span class="keyword">False</span>)</span><br></pre></td></tr></table></figure></p>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/box_new_colorize.png)</center>


<h5 id="Area面积图"><a href="#Area面积图" class="headerlink" title="Area面积图"></a>Area面积图</h5><p><b>Series.plot.area()</b> and <b>DataFrame.plot.area()</b></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(np.random.rand(<span class="number">10</span>, <span class="number">4</span>), columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">df.plot.area(stacked=<span class="keyword">True</span>)</span><br><span class="line"><span class="comment"># 如果stacked=False，图形不堆叠</span></span><br></pre></td></tr></table></figure>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/area_plot_stacked.png)</center>

<h5 id="Scatter散点图"><a href="#Scatter散点图" class="headerlink" title="Scatter散点图"></a>Scatter散点图</h5><p>using the <b>DataFrame.plot.scatter()</b> method<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(np.random.rand(<span class="number">50</span>, <span class="number">4</span>), columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">ax = df.plot.scatter(x=<span class="string">'a'</span>, y=<span class="string">'b'</span>, color=<span class="string">'DarkBlue'</span>, label=<span class="string">'Group 1'</span>)</span><br><span class="line"><span class="comment"># 两种不同颜色的组，注意ax=ax</span></span><br><span class="line">df.plot.scatter(x=<span class="string">'c'</span>, y=<span class="string">'d'</span>, color=<span class="string">'DarkGreen'</span>, label=<span class="string">'Group 2'</span>, ax=ax)</span><br><span class="line"></span><br><span class="line">df.plot.scatter(x=<span class="string">'a'</span>, y=<span class="string">'b'</span>, c=<span class="string">'c'</span>, s=<span class="number">50</span>)  <span class="comment"># 下图</span></span><br><span class="line"><span class="comment"># 用c的值确定bubble大小</span></span><br><span class="line">df.plot.scatter(x=<span class="string">'a'</span>, y=<span class="string">'b'</span>, s=df[<span class="string">'c'</span>]*<span class="number">200</span>)</span><br></pre></td></tr></table></figure></p>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/scatter_plot_colored.png)</center>

<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/scatter_plot_bubble.png)</center>

<h5 id="Hexagonal-Bin-Plot六边形箱图"><a href="#Hexagonal-Bin-Plot六边形箱图" class="headerlink" title="Hexagonal Bin Plot六边形箱图"></a>Hexagonal Bin Plot六边形箱图</h5><p>数据过多，过于密集，无法显示出每一个数据，所以就显示<b>数据密度相关参数</b><br>use<b> DataFrame.plot.hexbin()</b><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">1000</span>, <span class="number">2</span>), columns=[<span class="string">'a'</span>, <span class="string">'b'</span>])</span><br><span class="line">df[<span class="string">'b'</span>] = df[<span class="string">'b'</span>] + np.arange(<span class="number">1000</span>)</span><br><span class="line"><span class="comment"># gridsize决定网格能有多少个，默认值为100</span></span><br><span class="line">df.plot.hexbin(x=<span class="string">'a'</span>, y=<span class="string">'b'</span>, gridsize=<span class="number">25</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># a和b作为二维坐标，C作为值，reduce_C_function是一个用于处理多个数据值的函数</span></span><br><span class="line"><span class="comment"># reduce_C_function包括：mean, max, sum, std等，下面有图</span></span><br><span class="line">df.plot.hexbin(x=<span class="string">'a'</span>, y=<span class="string">'b'</span>, C=<span class="string">'z'</span>, reduce_C_function=np.max, gridsize=<span class="number">25</span>)</span><br></pre></td></tr></table></figure></p>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/hexbin_plot_agg.png)</center>

<h5 id="Pie饼图"><a href="#Pie饼图" class="headerlink" title="Pie饼图"></a>Pie饼图</h5><p><b>DataFrame.plot.pie()</b> or <b>Series.plot.pie()</b><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">series = pd.Series(<span class="number">3</span> * np.random.rand(<span class="number">4</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], name=<span class="string">'series'</span>)</span><br><span class="line"><span class="comment"># Series的饼状图</span></span><br><span class="line">series.plot.pie(figsize=(<span class="number">6</span>, <span class="number">6</span>))</span><br><span class="line"><span class="comment"># 使用subplot，每一列都是一个饼图，subplots=True要有</span></span><br><span class="line">df = pd.DataFrame(<span class="number">3</span> * np.random.rand(<span class="number">4</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], columns=[<span class="string">'x'</span>, <span class="string">'y'</span>])</span><br><span class="line">df.plot.pie(subplots=<span class="keyword">True</span>, figsize=(<span class="number">8</span>, <span class="number">4</span>))</span><br><span class="line"><span class="comment"># labels=['AA', 'BB', 'CC', 'DD']   每个扇形的标签</span></span><br><span class="line"><span class="comment"># colors=['r', 'g', 'b', 'c']    每个扇形的颜色</span></span><br><span class="line"><span class="comment"># autopct='%.2f'    显示比例、显示精度</span></span><br><span class="line"><span class="comment"># fontsize=20       字体大小</span></span><br></pre></td></tr></table></figure></p>
<h5 id="Density-plot"><a href="#Density-plot" class="headerlink" title="Density plot"></a>Density plot</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ser = pd.Series(np.random.randn(<span class="number">1000</span>))</span><br><span class="line">ser.plot.kde()  <span class="comment"># 数量越多就越接近高斯分布</span></span><br></pre></td></tr></table></figure>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/kde_plot.png)</center>

<h5 id="Scatter-Matrix-Plot"><a href="#Scatter-Matrix-Plot" class="headerlink" title="Scatter Matrix Plot"></a>Scatter Matrix Plot</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.tools.plotting <span class="keyword">import</span> scatter_matrix</span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">1000</span>, <span class="number">4</span>), columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">scatter_matrix(df, alpha=<span class="number">0.2</span>, figsize=(<span class="number">6</span>, <span class="number">6</span>), diagonal=<span class="string">'kde'</span>)</span><br></pre></td></tr></table></figure>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/scatter_matrix_kde.png)</center>

<h5 id="多元数据可视化"><a href="#多元数据可视化" class="headerlink" title="多元数据可视化"></a>多元数据可视化</h5><h6 id="Andrews曲线"><a href="#Andrews曲线" class="headerlink" title="Andrews曲线"></a>Andrews曲线</h6><p>可以应用于多元数据，将其绘制成使用样本属性作为傅里叶级数参数的大量曲线。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.tools.plotting <span class="keyword">import</span> andrews_curves</span><br><span class="line">data = pd.read_csv(<span class="string">'data/iris.data'</span>)</span><br><span class="line">andrews_curves(data, <span class="string">'Name'</span>)   <span class="comment"># Name是类别属性，根据类别划分</span></span><br></pre></td></tr></table></figure></p>
<center>iris.data中的数据</center>

<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">SepalLength</th>
<th style="text-align:center">SepalWidth</th>
<th style="text-align:center">PetalLength</th>
<th style="text-align:center">PetalWidth</th>
<th style="text-align:center">Name</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">5.1</td>
<td style="text-align:center">3.5</td>
<td style="text-align:center">1.4</td>
<td style="text-align:center">0.2</td>
<td style="text-align:center">Iris-setosa</td>
</tr>
</tbody>
</table>
</div>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/andrews_curves.png)</center>

<h6 id="Parallel-Coordinates平行坐标系"><a href="#Parallel-Coordinates平行坐标系" class="headerlink" title="Parallel Coordinates平行坐标系"></a>Parallel Coordinates平行坐标系</h6><p>可以应用于多元数据,每个垂直的线都对应一个属性<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.tools.plotting <span class="keyword">import</span> parallel_coordinates</span><br><span class="line">data = pd.read_csv(<span class="string">'data/iris.data'</span>)</span><br><span class="line">parallel_coordinates(data, <span class="string">'Name'</span>)</span><br></pre></td></tr></table></figure></p>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/parallel_coordinates.png)</center>

<h5 id="随机性检测"><a href="#随机性检测" class="headerlink" title="随机性检测"></a>随机性检测</h5><h6 id="Lag-Plot"><a href="#Lag-Plot" class="headerlink" title="Lag Plot"></a>Lag Plot</h6><p>用于检测数据集或者是时间序列数据是否是随机数据,显示data[t]和data[t+1]的关系。<br>如果plot出的图形是无规则的，那么数据有极大的可能性是随机的。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.tools.plotting <span class="keyword">import</span> lag_plot</span><br><span class="line">data = pd.Series(np.arange(<span class="number">1000</span>))  <span class="comment"># 有规则</span></span><br><span class="line">data = pd.Series(np.random.rand(<span class="number">1000</span>)) <span class="comment"># 无规则</span></span><br><span class="line">data = pd.Series(<span class="number">0.1</span> * np.random.rand(<span class="number">1000</span>) + <span class="number">0.9</span> * np.sin(np.linspace(<span class="number">-99</span> * np.pi, <span class="number">99</span> * np.pi, num=<span class="number">1000</span>)))  <span class="comment"># 有规则， 有图</span></span><br><span class="line">lag_plot(data)</span><br></pre></td></tr></table></figure></p>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/lag_plot.png)</center>

<h6 id="Autocorrelation-Plot"><a href="#Autocorrelation-Plot" class="headerlink" title="Autocorrelation Plot"></a>Autocorrelation Plot</h6><p>用于检测时序数据的随机性，通过计算不同的时间延迟（步长）下数据的自相关系数<br>如果这个序列是随机的，那么对于所有的延迟，其自相关系数都应该接近于0。否则，必然存在至少一个延迟对应的自相关系数远大于/小于0<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.tools.plotting <span class="keyword">import</span> autocorrelation_plot</span><br><span class="line">data = pd.Series(<span class="number">0.7</span> * np.random.rand(<span class="number">1000</span>) + <span class="number">0.3</span> * np.sin(np.linspace(<span class="number">-9</span> * np.pi, <span class="number">9</span> * np.pi, num=<span class="number">1000</span>)))</span><br><span class="line">autocorrelation_plot(data)</span><br></pre></td></tr></table></figure></p>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/autocorrelation_plot.png)</center>

<p>其中，中间黑线的0值线，向外的实线和虚线分别是95%、99%置信带，有颜色的线是不同延迟对应的自相关系数。</p>
<h6 id="Bootstrap-Plot"><a href="#Bootstrap-Plot" class="headerlink" title="Bootstrap Plot"></a>Bootstrap Plot</h6><p>可视化地评估统计信息的不确定性，比如说均值、中值、中距等<br>方法：从数据集中随机选取特定长度的子集并计算其相应的统计信息，重复特定次数<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.tools.plotting <span class="keyword">import</span> bootstrap_plot</span><br><span class="line">data = pd.Series(np.random.rand(<span class="number">1000</span>))</span><br><span class="line">bootstrap_plot(data, size=<span class="number">50</span>, samples=<span class="number">500</span>, color=<span class="string">'grey'</span>)</span><br></pre></td></tr></table></figure></p>
<center>![](http://pandas.pydata.org/pandas-docs/stable/_images/bootstrap_plot.png)</center>

<h5 id="Colormaps"><a href="#Colormaps" class="headerlink" title="Colormaps"></a>Colormaps</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> cm</span><br><span class="line"><span class="comment"># df.plot(colormap='cubehelix')</span></span><br><span class="line"><span class="comment"># df.plot(colormap=cm.cubehelix)</span></span><br><span class="line"><span class="comment"># colormap='Greens'</span></span><br><span class="line"><span class="comment"># colormap='gist_rainbow'</span></span><br><span class="line"><span class="comment"># colormap='winter'</span></span><br><span class="line">dd = pd.DataFrame(np.random.randn(<span class="number">10</span>, <span class="number">10</span>)).applymap(abs)</span><br><span class="line">dd = dd.cumsum()</span><br><span class="line">dd.plot.bar(colormap=<span class="string">'Greens'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="http://pandas.pydata.org/pandas-docs/stable/_images/greens.png" alt=""></p>
<h5 id="Plotting-Tables"><a href="#Plotting-Tables" class="headerlink" title="Plotting Tables"></a>Plotting Tables</h5><p>关键字table=True，table关键字也可以使用DataFrame或者Series作为值<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fig, ax = plt.subplots(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">df = pd.DataFrame(np.random.rand(<span class="number">5</span>, <span class="number">3</span>), columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line">ax.get_xaxis().set_visible(<span class="keyword">False</span>)   <span class="comment"># Hide Ticks</span></span><br><span class="line">df.plot(table=<span class="keyword">True</span>, ax=ax)</span><br></pre></td></tr></table></figure></p>
<p><img src="http://pandas.pydata.org/pandas-docs/stable/_images/line_plot_table_data.png" alt=""></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="atlantic8.github.io/2016/07/10/python-visualization/" data-id="ck66fyo1r00ab0wphi27153no" class="article-share-link"><i class="fas fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-python数据加载、存储与文件格式" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/06/23/python数据加载、存储与文件格式/">python数据加载、存储与文件格式</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2016/06/23/python数据加载、存储与文件格式/">
            <time datetime="2016-06-23T07:37:19.000Z" itemprop="datePublished">2016-06-23</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/pandas/">pandas</a>, <a class="tag-link" href="/tags/python/">python</a>, <a class="tag-link" href="/tags/文件/">文件</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h5 id="csv"><a href="#csv" class="headerlink" title="csv"></a>csv</h5><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">输入函数</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">read_csv</td>
<td style="text-align:center">从文件、URL、文件对象中加载带分隔符(,)的数据</td>
</tr>
<tr>
<td style="text-align:center">read_table</td>
<td style="text-align:center">从文件、URL、文件对象中加载带分隔符(默认为制表符:\t)的数据</td>
</tr>
<tr>
<td style="text-align:center">read_fwf</td>
<td style="text-align:center">读取顶宽列格式数据(没有分隔符)</td>
</tr>
<tr>
<td style="text-align:center">read_clipboard</td>
<td style="text-align:center">读取剪贴板数据，read_table的剪贴板版</td>
</tr>
<tr>
<td style="text-align:center">from_csv</td>
<td style="text-align:center">Series的方法，直接读出Series实例</td>
</tr>
</tbody>
</table>
</div>
<h6 id="一些上述函数扩展用法"><a href="#一些上述函数扩展用法" class="headerlink" title="一些上述函数扩展用法"></a>一些上述函数扩展用法</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> DataFrame,Series</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定分隔符，也可用delimiter，读取前10行数据</span></span><br><span class="line">pd.read_table(<span class="string">'filename'</span>, sep=<span class="string">','</span>,nrows=<span class="number">10</span>)</span><br><span class="line"><span class="comment"># 读取特定大小的文件块(byte)</span></span><br><span class="line">pd.read_table(<span class="string">'filename'</span>, chunksize=<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读入DataFrame时，指定列名</span></span><br><span class="line">pd.read_csv(<span class="string">'filename'</span>, header=<span class="keyword">None</span>)</span><br><span class="line">pd.read_csv(<span class="string">'filename'</span>, names=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定列为索引，列d设为索引</span></span><br><span class="line">pd.read_csv(<span class="string">'filename'</span>, names=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>], index_col=<span class="string">'d'</span>)</span><br><span class="line"><span class="comment"># 层次化索引的话，可以index_col指定多个列名</span></span><br><span class="line">pd.read_csv(<span class="string">'filename'</span>, names=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>], index_col=[<span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 跳过文件的某些行</span></span><br><span class="line">pd.read_csv(<span class="string">'filename'</span>, skiprows=[<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>])</span><br><span class="line"><span class="comment"># 需要忽略的行数，从尾部算起</span></span><br><span class="line">pd.read_csv(<span class="string">'filename'</span>, skip_footer=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读文件缺失值处理，将文件中某些值设置为nan</span></span><br><span class="line">pd.read_csv(<span class="string">'filename'</span>, na_values=[<span class="string">'NULL'</span>])</span><br><span class="line"><span class="comment"># 将文件中满足box条件的值设置为nan</span></span><br><span class="line">box = &#123;<span class="string">'col1'</span>:[<span class="string">'foo'</span>,<span class="string">'NA'</span>], <span class="string">'col3'</span>:[<span class="string">'two'</span>]&#125;</span><br><span class="line">pd.read_csv(<span class="string">'filename'</span>, na_values=[<span class="string">'NULL'</span>])</span><br><span class="line"><span class="comment"># 写文件缺失值处理，将nan写成na_rep</span></span><br><span class="line">pd.read_csv(<span class="string">'filename'</span>, na_rep=<span class="string">'NULL'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日期解析,解析所有列，也可以指定，默认为False;</span></span><br><span class="line"><span class="comment"># 冲突型日期，看成国际标准格式，28/6/2016, 默认为False</span></span><br><span class="line">pd.read_csv(<span class="string">'filename'</span>, parse_dates=<span class="keyword">True</span>, dayfirst=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置编码，数据解析后仅有一列返回Series</span></span><br><span class="line">pd.read_csv(<span class="string">'filename'</span>, encoding=<span class="string">'utf-8'</span>, squeeze=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">输出函数</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">to_csv</td>
<td style="text-align:center">把数据写入到文件、输出流中，分隔符为(,)，Series也有这个方法</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接打印</span></span><br><span class="line">data.to_csv(sys.stdout)</span><br><span class="line"><span class="comment"># 输出到文件，并且将nan用'NULL'替换</span></span><br><span class="line">data.to_csv(<span class="string">'filename'</span>, na_rep=<span class="string">'NULL'</span>)</span><br><span class="line"><span class="comment"># 列名和index也可以禁用</span></span><br><span class="line">data.to_csv(<span class="string">'filename'</span>, index=<span class="keyword">False</span>, header=<span class="keyword">False</span>)</span><br><span class="line"><span class="comment"># 通过指定cols可以显示特定的列</span></span><br><span class="line">data.to_csv(<span class="string">'filename'</span>, index=<span class="keyword">False</span>, cols=[<span class="string">'a'</span>,<span class="string">'b'</span>])</span><br></pre></td></tr></table></figure>
<h5 id="手工处理分隔符格式"><a href="#手工处理分隔符格式" class="headerlink" title="手工处理分隔符格式"></a>手工处理分隔符格式</h5><p>对于任何单字符分隔符文件，可以直接使用python内置的csv模块，将任意已打开的文件或文件对象传递给csv.reader:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line">f = open(<span class="string">'filename'</span>)</span><br><span class="line">reader = csv.reader(f)</span><br><span class="line"><span class="comment"># 对reader迭代会为每行产生一个元组</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> reader:</span><br><span class="line">    print(line)</span><br></pre></td></tr></table></figure></p>
<p>csv文件的形式多样只需定义csv.Dialect的一个子类即可定义出新格式<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">my_dialect</span><span class="params">(csv.Dialect)</span>:</span></span><br><span class="line">    lineterminator = <span class="string">'\n'</span></span><br><span class="line">    delimiter = <span class="string">';'</span></span><br><span class="line">    quotechar = <span class="string">'"'</span></span><br><span class="line"></span><br><span class="line">reader = csv.reader(f, dialect=my_dialect())</span><br></pre></td></tr></table></figure></p>
<p>csv.Dialect的属性还包括：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">属性</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">delimiter</td>
<td style="text-align:center">分隔字段的单字符字符串，默认为’,’</td>
</tr>
<tr>
<td style="text-align:center">lineterminator</td>
<td style="text-align:center">写操作的行终结符，默认为’\r\n’。读操作忽略，它能认出跨平台结束符</td>
</tr>
<tr>
<td style="text-align:center">quotechar</td>
<td style="text-align:center">用于带有特殊字符的字段的引用符号</td>
</tr>
<tr>
<td style="text-align:center">quoting</td>
<td style="text-align:center">引用约定。包括csv.QUOTE_ALL(引用所有字段)，csv.QUOTE_MINIMAL(只引用带有特殊字符的字段)，csv.QUOTE_NONNUMERIC(只引用非数值属性),csv.QUOTE_NON(不引用)</td>
</tr>
<tr>
<td style="text-align:center">skipinitialspace</td>
<td style="text-align:center">忽略分隔符后面的空白符，默认为False</td>
</tr>
<tr>
<td style="text-align:center">doublequote</td>
<td style="text-align:center">处理字段内的引用符号，如果为True则双写</td>
</tr>
<tr>
<td style="text-align:center">escapechar</td>
<td style="text-align:center">用于对分隔符进行转义的字符串，默认禁用</td>
</tr>
</tbody>
</table>
</div>
<p>要手工输出分隔符文件，使用csv.writer<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'filename'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">writer = csv.writer(f, dialect=my_dialect)</span><br><span class="line">writer.writerow((<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'three'</span>))</span><br><span class="line">writer.writerow((<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>))</span><br></pre></td></tr></table></figure></p>
<h4 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">obj = <span class="string">"""</span></span><br><span class="line"><span class="string">&#123;"name":"wes",</span></span><br><span class="line"><span class="string"> "place":["usa","russia","china"],</span></span><br><span class="line"><span class="string"> "pet": null,</span></span><br><span class="line"><span class="string"> "siblings": [&#123;"name":"scott","age":25, "pet":"Zuko"&#125;,&#123;"name":"katie","age":33, "pet":"Cisco"&#125;]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="comment"># 将json字符串转换成python形式</span></span><br><span class="line">result = json.loads(obj)</span><br><span class="line">$-&gt; &#123;u'name': u'wes',</span><br><span class="line">      <span class="string">u'pet'</span>: <span class="keyword">None</span>,</span><br><span class="line">      <span class="string">u'place'</span>: [<span class="string">u'usa'</span>, <span class="string">u'russia'</span>, <span class="string">u'china'</span>],</span><br><span class="line">      <span class="string">u'siblings'</span>: [&#123;<span class="string">u'age'</span>: <span class="number">25</span>, <span class="string">u'name'</span>: <span class="string">u'scott'</span>, <span class="string">u'pet'</span>: <span class="string">u'Zuko'</span>&#125;,</span><br><span class="line">     &#123;<span class="string">u'age'</span>: <span class="number">33</span>, <span class="string">u'name'</span>: <span class="string">u'katie'</span>, <span class="string">u'pet'</span>: <span class="string">u'Cisco'</span>&#125;]&#125;</span><br><span class="line"><span class="comment"># 将python字符串转换成json形式</span></span><br><span class="line">asjson = json.dumps(result)</span><br></pre></td></tr></table></figure>
<p>pandas团队正致力于开发原生的高效json导出(to_json)和解码(from_json)功能，待续………</p>
<h4 id="XML和HTML解析"><a href="#XML和HTML解析" class="headerlink" title="XML和HTML解析"></a>XML和HTML解析</h4><p>使用lxml.html处理HTML内容</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml.html <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">from</span> urllib2 <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line">parsed = parse(urlopen(<span class="string">'http://finance.yahoo.com/xxxx/xxx/xxx///xxxx'</span>))</span><br><span class="line">doc = parsed.getroot()</span><br><span class="line"><span class="comment"># 通过doc可以获得特定类型的所有html标签(tag)，比如table等</span></span><br><span class="line"></span><br><span class="line">links = doc.findall(<span class="string">'.//a'</span>)   <span class="comment"># 链接</span></span><br><span class="line">links[<span class="number">0</span>].get(<span class="string">'href'</span>)</span><br><span class="line">$-&gt; 'http://baidu.com'</span><br><span class="line">links[<span class="number">0</span>].text_content()</span><br><span class="line">$-&gt; '百度一下'</span><br></pre></td></tr></table></figure>
<p>处理表格，’.//table’<br>表格的每一行都是 ‘.//tr’<br>表格的第一行是标题行，th表示单元格<br>余下的行是数据行，td表示单元格<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.io.parsers <span class="keyword">import</span> TextParser</span><br><span class="line"><span class="comment"># 下面的是解析函数,解析一行数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_unpack</span><span class="params">(row, kind=<span class="string">'td'</span>)</span>:</span></span><br><span class="line">    elts = row.findall(<span class="string">'.//%s'</span> % kind)</span><br><span class="line">    <span class="keyword">return</span> [val.text_content() <span class="keyword">for</span> val <span class="keyword">in</span> elts]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析整个表格，返回一个DataFrame对象</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_table</span><span class="params">(table)</span>:</span></span><br><span class="line">    rows = table.findall(<span class="string">'.//tr'</span>)</span><br><span class="line">    header = _unpack(row[<span class="number">0</span>], kind=<span class="string">'th'</span>)</span><br><span class="line">    data = [_unpack(r) <span class="keyword">for</span> r <span class="keyword">in</span> rows[<span class="number">1</span>:]]</span><br><span class="line">    <span class="comment"># TextParser将数值型的列进行类型转化</span></span><br><span class="line">    <span class="keyword">return</span> TextParser(data, names=header).get_chunk()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定位所有的表格</span></span><br><span class="line">tables = doc.findall(<span class="string">'.//table'</span>)</span><br><span class="line">tab = tables[<span class="number">0</span>]</span><br><span class="line">parse_table(tab)</span><br></pre></td></tr></table></figure></p>
<p>使用lxml.objectify处理XML内容<br>root.INDICATOR用于返回一个用于产生各个XML元素的生成器。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> objectify</span><br><span class="line"></span><br><span class="line">parsed = objectify.parse(open(<span class="string">'hello.xml'</span>))</span><br><span class="line">root = parsed.getroot()</span><br><span class="line">root.get(<span class="string">'href'</span>)</span><br><span class="line">$-&gt; 'http://baidu.com'</span><br><span class="line">root.text</span><br><span class="line">$-&gt; '百度一下'</span><br><span class="line"></span><br><span class="line">data = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> elt <span class="keyword">in</span> root.INDICATOR:</span><br><span class="line">    el_data = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> child <span class="keyword">in</span> elt.getchildren():</span><br><span class="line">        el_data[child.tag] = child.pyval</span><br><span class="line">    data.append(el_data)</span><br><span class="line"><span class="comment"># 转化成DataFrame</span></span><br><span class="line">perf = DataFrame(data)</span><br></pre></td></tr></table></figure></p>
<h4 id="二进制数据和Excel文件"><a href="#二进制数据和Excel文件" class="headerlink" title="二进制数据和Excel文件"></a>二进制数据和Excel文件</h4><p>pandas对象有一个将数据以pickle序列化形式保存到磁盘上的方法：save<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写入磁盘</span></span><br><span class="line">frame.save(<span class="string">'filename'</span>)</span><br><span class="line"><span class="comment"># 读入内存</span></span><br><span class="line">frame = pd.load(<span class="string">'filename'</span>)</span><br></pre></td></tr></table></figure></p>
<p>使用xlrd包和openpyxl包(需要安装)读写xls或者xlsx文件<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建ExcelFile示例</span></span><br><span class="line">xls_file = pd.ExcelFile(<span class="string">'data.xls'</span>)</span><br><span class="line"><span class="comment"># 存放在某个工作表中的数据可以通过parse读取到DataFrame中</span></span><br><span class="line">table = xls_file.parse(<span class="string">'sheet1'</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="使用数据库"><a href="#使用数据库" class="headerlink" title="使用数据库"></a>使用数据库</h4><p>关系型数据库<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line"><span class="comment"># create table</span></span><br><span class="line">query = <span class="string">"""</span></span><br><span class="line"><span class="string">create table test</span></span><br><span class="line"><span class="string">(a varchar(20),</span></span><br><span class="line"><span class="string"> b integer);"""</span></span><br><span class="line">con = sqlite3.connect(<span class="string">':memory:'</span>)</span><br><span class="line">con.execute(query)</span><br><span class="line">con.commit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># insert</span></span><br><span class="line">data = [(<span class="string">'tom'</span>,<span class="number">20</span>),(<span class="string">'jerry'</span>,<span class="number">15</span>)]</span><br><span class="line">stmt = <span class="string">"insert into test values(?,?)"</span></span><br><span class="line">con.executemany(stmt, data)</span><br><span class="line">con.commit</span><br><span class="line"></span><br><span class="line"><span class="comment"># query, select返回元组列表(大部分python SQL驱动器都这样)</span></span><br><span class="line">cursor = con.execute(<span class="string">'select * from test'</span>)</span><br><span class="line">rows = cursor.fetchall()</span><br><span class="line">print(rows)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 由于这样产生DataFrame的方法比较复杂，所以有现成的方法</span></span><br><span class="line"><span class="keyword">import</span> pandas.io.sql <span class="keyword">as</span> sql</span><br><span class="line">sql.read_frame(<span class="string">'select * from test'</span>, con)</span><br></pre></td></tr></table></figure></p>
<p>非关系型数据库<br>非关系型数据库有多种方式，有些是字典键值对形式存在，另一些是基于文档的，这里不再赘述。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="atlantic8.github.io/2016/06/23/python数据加载、存储与文件格式/" data-id="ck66fyo1o00a80wph0fg25l4f" class="article-share-link"><i class="fas fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-NumPy基础" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/06/23/NumPy基础/">NumPy基础</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2016/06/23/NumPy基础/">
            <time datetime="2016-06-23T07:32:40.000Z" itemprop="datePublished">2016-06-23</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/numpy/">numpy</a>, <a class="tag-link" href="/tags/python/">python</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</span><br></pre></td></tr></table></figure>
<h4 id="ndarray：一种对维数组对象"><a href="#ndarray：一种对维数组对象" class="headerlink" title="ndarray：一种对维数组对象"></a>ndarray：一种对维数组对象</h4><p>创建方法</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">array</td>
<td style="text-align:center">将输入数据(列表、元组、数组或其他序列类型)转换为ndarray，可以指定dtype</td>
</tr>
<tr>
<td style="text-align:center">asarray</td>
<td style="text-align:center">将输入转换为ndarray，如果输入本身就是ndarray，则不进行复制</td>
</tr>
<tr>
<td style="text-align:center">arange</td>
<td style="text-align:center">同range，只是返回的是ndarray</td>
</tr>
<tr>
<td style="text-align:center">ones,ones_like</td>
<td style="text-align:center">前者根据指定形状和dtype创建一个全1数组。 后者以另一个数组为参照，copy其形状和dtype</td>
</tr>
<tr>
<td style="text-align:center">zeros,zeros_like</td>
<td style="text-align:center">前者根据指定形状和dtype创建一个全0数组。 后者以另一个数组为参照，copy其形状和dtype</td>
</tr>
<tr>
<td style="text-align:center">empty,empty_like</td>
<td style="text-align:center">只分配内存，不填充任何值</td>
</tr>
<tr>
<td style="text-align:center">eye,identity</td>
<td style="text-align:center">单位矩阵</td>
</tr>
</tbody>
</table>
</div>
<p>NumPy的精度dtype集合，实际使用应该加上np.前缀</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">dtype</th>
<th style="text-align:center">dtype</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">int8, uint8</td>
<td style="text-align:center">int16,uint16</td>
</tr>
<tr>
<td style="text-align:center">int32, uint32</td>
<td style="text-align:center">int64,uint64</td>
</tr>
<tr>
<td style="text-align:center">float16, float32</td>
<td style="text-align:center">float64,float128</td>
</tr>
<tr>
<td style="text-align:center">complex64</td>
<td style="text-align:center">complex128</td>
</tr>
<tr>
<td style="text-align:center">complex256</td>
<td style="text-align:center">bool</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># construct</span></span><br><span class="line">arr1 = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">arr1.ndim</span><br><span class="line">$-&gt; 1 # 一维数组</span><br><span class="line">arr1.shape</span><br><span class="line">$-&gt; (1,5) # 1x5的数组</span><br><span class="line">arr1.dtype</span><br><span class="line">$-&gt; dtype('int64')</span><br><span class="line"></span><br><span class="line"><span class="comment"># type convert，这里一定会常见一个新的数组，无论目标转换类型与原数组类型是否一致</span></span><br><span class="line">float_arr = arr1.astype(np.float64)</span><br></pre></td></tr></table></figure>
<h4 id="索引与切片"><a href="#索引与切片" class="headerlink" title="索引与切片"></a>索引与切片</h4><p>索引切片方法与list的对应方法相似，不同点在于：<br><b>数组切片也是原始数组的视图，这意味着数据不会被复制，因此视图上的任何更改都会直接地反映到源数组上。而list不然</b>，请具体看下面的例子。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">b = a[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">b[<span class="number">1</span>] = <span class="number">100</span></span><br><span class="line">print(a)</span><br><span class="line">$-&gt; [1, 2, 3, 4, 5, 6]</span><br><span class="line"></span><br><span class="line">arr = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>])</span><br><span class="line">br = arr[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">br[<span class="number">1</span>] = <span class="number">99</span></span><br><span class="line">arr</span><br><span class="line">$-&gt; array([ 1,  2,  3, 99,  5,  6])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果需要ndarray的切片的副本而非视图，可以显示地复制</span></span><br><span class="line">new_arr = arr[<span class="number">2</span>:<span class="number">5</span>].copy()</span><br></pre></td></tr></table></figure></p>
<p>多维数组的切片<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">arr2d = np.array([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>],[<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]])</span><br><span class="line">arr2d[<span class="number">1</span>][<span class="number">1</span>]</span><br><span class="line">$-&gt; 1</span><br><span class="line">arr2d[<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line">$-&gt; 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 沿着第0轴(第一个轴)切片</span></span><br><span class="line">arr2d[:<span class="number">2</span>]</span><br><span class="line">$-&gt; array([[1, 2, 3],</span><br><span class="line">           [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]])</span><br><span class="line">arr2d[:<span class="number">2</span>,<span class="number">1</span>:]</span><br><span class="line">$-&gt; array([[2, 3],</span><br><span class="line">           [<span class="number">5</span>, <span class="number">6</span>]])</span><br><span class="line">arr2d[:,:<span class="number">1</span>]</span><br><span class="line">$-&gt; array([[1],</span><br><span class="line">           [<span class="number">4</span>],</span><br><span class="line">           [<span class="number">7</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># bool索引与赋值</span></span><br><span class="line">arr&lt;<span class="number">4</span></span><br><span class="line">$-&gt; array([ True,  True,  True, False, False, False], dtype=bool)</span><br><span class="line">arr[arr&lt;<span class="number">4</span>] = <span class="number">4</span></span><br><span class="line">arr</span><br><span class="line">$-&gt; array([ 4,  4,  4, 99,  5,  6])</span><br></pre></td></tr></table></figure></p>
<p><b>花式索引(fancy indexing)</b>,<b>花式索引总是将数据复制到新数组中</b>，切片得到的是视图。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">arr = np.empty((<span class="number">8</span>,<span class="number">4</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">    arr[i] = i</span><br><span class="line">arr</span><br><span class="line">$-&gt; array([[ 0.,  0.,  0.,  0.],</span><br><span class="line">           [ <span class="number">1.</span>,  <span class="number">1.</span>,  <span class="number">1.</span>,  <span class="number">1.</span>],</span><br><span class="line">           [ <span class="number">2.</span>,  <span class="number">2.</span>,  <span class="number">2.</span>,  <span class="number">2.</span>],</span><br><span class="line">             [ <span class="number">3.</span>,  <span class="number">3.</span>,  <span class="number">3.</span>,  <span class="number">3.</span>],</span><br><span class="line">           [ <span class="number">4.</span>,  <span class="number">4.</span>,  <span class="number">4.</span>,  <span class="number">4.</span>],</span><br><span class="line">           [ <span class="number">5.</span>,  <span class="number">5.</span>,  <span class="number">5.</span>,  <span class="number">5.</span>],</span><br><span class="line">           [ <span class="number">6.</span>,  <span class="number">6.</span>,  <span class="number">6.</span>,  <span class="number">6.</span>],</span><br><span class="line">           [ <span class="number">7.</span>,  <span class="number">7.</span>,  <span class="number">7.</span>,  <span class="number">7.</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以特定顺序选取行子集，传入一个制定顺序的证书列表或者ndarray</span></span><br><span class="line">arr[[<span class="number">4</span>,<span class="number">2</span>,<span class="number">6</span>]]  <span class="comment"># 打印第5、3、7行</span></span><br><span class="line">$-&gt; array([[ 4.,  4.,  4.,  4.],</span><br><span class="line">           [ <span class="number">2.</span>,  <span class="number">2.</span>,  <span class="number">2.</span>,  <span class="number">2.</span>],</span><br><span class="line">           [ <span class="number">6.</span>,  <span class="number">6.</span>,  <span class="number">6.</span>,  <span class="number">6.</span>]])</span><br><span class="line"><span class="comment"># 如果使用负数将从末尾计数</span></span><br><span class="line">arr[[<span class="number">-2</span>,<span class="number">-1</span>,<span class="number">4</span>]] <span class="comment"># 倒数第二行、第一行和正数第5行</span></span><br><span class="line">$-&gt; array([[ 6.,  6.,  6.,  6.],</span><br><span class="line">           [ <span class="number">7.</span>,  <span class="number">7.</span>,  <span class="number">7.</span>,  <span class="number">7.</span>],</span><br><span class="line">           [ <span class="number">4.</span>,  <span class="number">4.</span>,  <span class="number">4.</span>,  <span class="number">4.</span>]])</span><br><span class="line"></span><br><span class="line">arr = np.arange(<span class="number">32</span>).reshape((<span class="number">8</span>,<span class="number">4</span>))</span><br><span class="line">arr[[<span class="number">1</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">2</span>],[<span class="number">0</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>]]</span><br><span class="line">$-&gt; array([ 4, 23, 29, 10])</span><br><span class="line"><span class="comment"># 上面操作结果没有返回一个指示对应行列值得矩阵，方法如下：</span></span><br><span class="line">arr[np.ix_([<span class="number">1</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">2</span>],[<span class="number">0</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>])]</span><br><span class="line">$-&gt; array([[ 4,  7,  5,  6],</span><br><span class="line">           [<span class="number">20</span>, <span class="number">23</span>, <span class="number">21</span>, <span class="number">22</span>],</span><br><span class="line">           [<span class="number">28</span>, <span class="number">31</span>, <span class="number">29</span>, <span class="number">30</span>],</span><br><span class="line">           [ <span class="number">8</span>, <span class="number">11</span>,  <span class="number">9</span>, <span class="number">10</span>]])</span><br></pre></td></tr></table></figure></p>
<p><b>数组轴对换和转置</b><br>数组不仅有transpose方法(返回数据源视图，不复制)，还有T属性，二维的情况很容易理解，下面是高纬轴对换的例子。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">arr = np.arange(<span class="number">16</span>).reshape((<span class="number">2</span>,<span class="number">2</span>,<span class="number">4</span>))</span><br><span class="line">arr</span><br><span class="line">$-&gt; array([[[ 0,  1,  2,  3],</span><br><span class="line">            [ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>]],</span><br><span class="line"></span><br><span class="line">           [[ <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>],</span><br><span class="line">            [<span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>]]])</span><br><span class="line">arr.transpose((<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>))</span><br><span class="line">$-&gt; array([[[ 0,  1,  2,  3],</span><br><span class="line">            [ <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]],</span><br><span class="line"></span><br><span class="line">           [[ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>],</span><br><span class="line">            [<span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>]]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># swapaxes,返回数据源视图，不复制</span></span><br><span class="line">arr = np.arange(<span class="number">16</span>).reshape((<span class="number">2</span>,<span class="number">2</span>,<span class="number">4</span>))</span><br><span class="line">arr.swapaxes(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">Out[<span class="number">53</span>]:</span><br><span class="line">array([[[ <span class="number">0</span>,  <span class="number">4</span>],</span><br><span class="line">        [ <span class="number">1</span>,  <span class="number">5</span>],</span><br><span class="line">        [ <span class="number">2</span>,  <span class="number">6</span>],</span><br><span class="line">        [ <span class="number">3</span>,  <span class="number">7</span>]],</span><br><span class="line"></span><br><span class="line">       [[ <span class="number">8</span>, <span class="number">12</span>],</span><br><span class="line">        [ <span class="number">9</span>, <span class="number">13</span>],</span><br><span class="line">        [<span class="number">10</span>, <span class="number">14</span>],</span><br><span class="line">        [<span class="number">11</span>, <span class="number">15</span>]]])</span><br></pre></td></tr></table></figure></p>
<h4 id="通用函数，元素级数组函数"><a href="#通用函数，元素级数组函数" class="headerlink" title="通用函数，元素级数组函数"></a>通用函数，元素级数组函数</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">一元函数</th>
<th style="text-align:center">说明</th>
<th style="text-align:center">一元函数</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">abs,fabs</td>
<td style="text-align:center">求绝对值，实数用fabs更快</td>
<td style="text-align:center">sqrt</td>
<td style="text-align:center">计算各元素平方根,相当于arr**0.5</td>
</tr>
<tr>
<td style="text-align:center">square</td>
<td style="text-align:center">计算各元素平方,相当于arr**2</td>
<td style="text-align:center">exp</td>
<td style="text-align:center">计算e的元素次方</td>
</tr>
<tr>
<td style="text-align:center">log,log10,log2,log1p</td>
<td style="text-align:center">对数运算，最后一个是log(1+x)</td>
<td style="text-align:center">sign</td>
<td style="text-align:center">指示符号，(1,0,-1)</td>
</tr>
<tr>
<td style="text-align:center">ceil</td>
<td style="text-align:center">向上取整</td>
<td style="text-align:center">floor</td>
<td style="text-align:center">向下取整</td>
</tr>
<tr>
<td style="text-align:center">rint</td>
<td style="text-align:center">四舍五入到最近的整数，保留dtype</td>
<td style="text-align:center">modf</td>
<td style="text-align:center">将数组的整数和小数部分以两个独立数组的形式返回</td>
</tr>
<tr>
<td style="text-align:center">isnan</td>
<td style="text-align:center">返回哪些是NaN的bool数组</td>
<td style="text-align:center">isfinite,isinf</td>
<td style="text-align:center">返回哪些是有穷的/无穷的bool数组</td>
</tr>
<tr>
<td style="text-align:center">cos,cosh,sin,sinh,tan,tanh</td>
<td style="text-align:center">普通型和双曲型三角函数</td>
<td style="text-align:center">logical_not</td>
<td style="text-align:center">计算各元素not x的真值，相当于-arr</td>
</tr>
<tr>
<td style="text-align:center">arccos,arccosh,arcsin,arcsinh,arctan,arctanh</td>
<td style="text-align:center">反三角函数</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">二元函数</th>
<th style="text-align:center">说明</th>
<th style="text-align:center">二元函数</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">add</td>
<td style="text-align:center">数值中对应元素相加</td>
<td style="text-align:center">substract</td>
<td style="text-align:center">第一个数组元素减去第二个数组元素</td>
</tr>
<tr>
<td style="text-align:center">multiply</td>
<td style="text-align:center">数组元素相乘</td>
<td style="text-align:center">divide,floor_divide</td>
<td style="text-align:center">除法，向下圆整除法</td>
</tr>
<tr>
<td style="text-align:center">power</td>
<td style="text-align:center">第一个数组元素为底，第二个数组元素为顶计算乘方</td>
<td style="text-align:center">maximum,fmax</td>
<td style="text-align:center">最大值，fmax忽略nan</td>
</tr>
<tr>
<td style="text-align:center">minimum,fmin</td>
<td style="text-align:center">fmin忽略nan</td>
<td style="text-align:center">mod</td>
<td style="text-align:center">求模</td>
</tr>
<tr>
<td style="text-align:center">copysign</td>
<td style="text-align:center">将第二个数组元素的符号赋给第一个数组的元素</td>
<td style="text-align:center">greater,greater_equal,less,less_equal</td>
<td style="text-align:center">比较运算，产生bool数组</td>
</tr>
<tr>
<td style="text-align:center">equal,not_equal</td>
<td style="text-align:center">比较运算，产生bool数组</td>
<td style="text-align:center">logical_and,logical_or,logical_xor</td>
<td style="text-align:center">元素级真值逻辑运算</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">arr = np.arange(<span class="number">10</span>)</span><br><span class="line">np.sqrt(arr)</span><br><span class="line"></span><br><span class="line">x = randn(<span class="number">8</span>)</span><br><span class="line">y = randn(<span class="number">8</span>)</span><br><span class="line">np.maximum(x,y)</span><br><span class="line"></span><br><span class="line">arr = randn(<span class="number">8</span>)*<span class="number">5</span></span><br><span class="line">np.modf(arr)</span><br><span class="line">$-&gt; (array([[-0.06742411, -0.37438428,  0.7491406 ,  0.63876896, -0.73629364,</span><br><span class="line">           <span class="number">0.60505606</span>, <span class="number">-0.38540241</span>,  <span class="number">0.78968936</span>]]),</span><br><span class="line"> array([[<span class="number">-1.</span>, <span class="number">-1.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>, <span class="number">-1.</span>,  <span class="number">1.</span>, <span class="number">-1.</span>,  <span class="number">0.</span>]]))</span><br></pre></td></tr></table></figure>
<h4 id="数据处理和统计"><a href="#数据处理和统计" class="headerlink" title="数据处理和统计"></a>数据处理和统计</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">points = np.arange(<span class="number">-5</span>,<span class="number">5</span>,<span class="number">0.01</span>) <span class="comment"># 1000个间隔相等的点</span></span><br><span class="line">xs,ys = np.meshgrid(points, points)</span><br><span class="line">z = np.sqrt(xs**<span class="number">2</span>+ys**<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">xarr = np.array([<span class="number">1.1</span>,<span class="number">1.2</span>,<span class="number">1.3</span>,<span class="number">1.4</span>,<span class="number">1.5</span>])</span><br><span class="line">yarr = np.array([<span class="number">2.1</span>,<span class="number">2.2</span>,<span class="number">2.3</span>,<span class="number">2.4</span>,<span class="number">2.5</span>])</span><br><span class="line">cond = np.array([<span class="keyword">True</span>,<span class="keyword">False</span>,<span class="keyword">True</span>,<span class="keyword">True</span>,<span class="keyword">False</span>])</span><br><span class="line"><span class="comment"># 根据cond的情况选取xarr或者yarr</span></span><br><span class="line">result = [(x <span class="keyword">if</span> c <span class="keyword">else</span> x) <span class="keyword">for</span> x,y,c <span class="keyword">in</span> xarr,yarr,cond]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上述方法对大数组处理速度较慢，且无法用于多维数组</span></span><br><span class="line"><span class="comment"># np.where函数通常用于：根据一个数组产生另一个数组</span></span><br><span class="line">result = np.where(cond, xarr, yarr)</span><br><span class="line"></span><br><span class="line">arr = randn(<span class="number">4</span>,<span class="number">4</span>)</span><br><span class="line">arr</span><br><span class="line">$-&gt; array([[ 1.52182545,  0.87451946,  1.04261881, -1.0087171 ],</span><br><span class="line">            [<span class="number">-0.17748091</span>, <span class="number">-0.11488603</span>, <span class="number">-0.29951479</span>,  <span class="number">0.67766543</span>],</span><br><span class="line">            [<span class="number">-0.21761354</span>, <span class="number">-0.83476571</span>,  <span class="number">1.69775644</span>,  <span class="number">1.45229995</span>],</span><br><span class="line">            [ <span class="number">0.1791336</span> ,  <span class="number">1.55750933</span>,  <span class="number">0.23509194</span>,  <span class="number">0.39716205</span>]])</span><br><span class="line">np.where(arr&gt;<span class="number">0</span>, <span class="number">2</span>, <span class="number">-2</span>) <span class="comment"># 把大于0的都换成2，小于0的换成-2</span></span><br><span class="line">$-&gt; array([[ 2,  2,  2, -2],</span><br><span class="line">           [<span class="number">-2</span>, <span class="number">-2</span>, <span class="number">-2</span>,  <span class="number">2</span>],</span><br><span class="line">           [<span class="number">-2</span>, <span class="number">-2</span>,  <span class="number">2</span>,  <span class="number">2</span>],</span><br><span class="line">           [ <span class="number">2</span>,  <span class="number">2</span>,  <span class="number">2</span>,  <span class="number">2</span>]])</span><br></pre></td></tr></table></figure>
<p><b>基本数组统计方法</b><br>既是数组示例的方法，也是顶级方法。这类函数可以接受一个axis参数，表示轴向方向</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">sum</td>
<td>求和，对于bool值数组，sum计算True的个数</td>
</tr>
<tr>
<td style="text-align:center">mean</td>
<td>均值，长度为0的均值为NaN</td>
</tr>
<tr>
<td style="text-align:center">std,var</td>
<td>标准差和方差，自由度可调，默认为n</td>
</tr>
<tr>
<td style="text-align:center">min,max</td>
<td>最小值，最大值</td>
</tr>
<tr>
<td style="text-align:center">argmin,argmax</td>
<td>最小、最大元素的索引</td>
</tr>
<tr>
<td style="text-align:center">cumsum</td>
<td>所有元素累计和</td>
</tr>
<tr>
<td style="text-align:center">cumprod</td>
<td>所有元素累计积</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">arr.mean(axis=<span class="number">1</span>)</span><br><span class="line">arr = np.arange(<span class="number">9</span>).reshape((<span class="number">3</span>,<span class="number">3</span>))</span><br><span class="line">arr.cumsum(axis=<span class="number">0</span>) <span class="comment"># 列和</span></span><br><span class="line">$-&gt; array([[ 0,  1,  2],</span><br><span class="line">           [ <span class="number">3</span>,  <span class="number">5</span>,  <span class="number">7</span>],</span><br><span class="line">           [ <span class="number">9</span>, <span class="number">12</span>, <span class="number">15</span>]])</span><br><span class="line">arr.cumprod(<span class="number">1</span>)  <span class="comment">#行积</span></span><br><span class="line">$-&gt; array([[  0,   0,   0],</span><br><span class="line">           [  <span class="number">3</span>,  <span class="number">12</span>,  <span class="number">60</span>],</span><br><span class="line">           [  <span class="number">6</span>,  <span class="number">42</span>, <span class="number">336</span>]])</span><br></pre></td></tr></table></figure>
<p><b>用于bool数组的方法</b><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(arr&gt;<span class="number">0</span>).sum()  <span class="comment">#计算正值数量</span></span><br><span class="line">bools = np.array([<span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">True</span>, <span class="keyword">False</span>])</span><br><span class="line"><span class="comment"># any用于检测数组中是否有True， all检查是否都是True</span></span><br><span class="line">bools.any() -&gt; True</span><br><span class="line">bools.all() -&gt; False</span><br></pre></td></tr></table></figure></p>
<p><b>排序</b><br>顶级方法np.sort返回排序完的副本，就地排序则会修改数组本身<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">arr = randn(<span class="number">8</span>)</span><br><span class="line">arr.sort()</span><br><span class="line">np.array(arr)</span><br><span class="line">$-&gt; array([[ 0.4811325 ],</span><br><span class="line">           [ <span class="number">1.49888281</span>],</span><br><span class="line">           [ <span class="number">0.71035914</span>],</span><br><span class="line">           [<span class="number">-1.24322946</span>],</span><br><span class="line">           [ <span class="number">0.90270716</span>],</span><br><span class="line">           [ <span class="number">1.29337938</span>],</span><br><span class="line">           [<span class="number">-0.29419419</span>],</span><br><span class="line">           [ <span class="number">0.71318192</span>]])</span><br><span class="line">arr = randn(<span class="number">5</span>,<span class="number">3</span>)</span><br><span class="line">arr.sort(axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure></p>
<p><b>数组集合运算</b></p>
<p>|    函数    |    说明    |<br>|  unique(x) | 计算x中的唯一元素，返回排序好的结果  |<br>|  intersect1d(x,y) |  计算x和y中的公共元素(交集)，返回排序好的结果 |<br>|  union1d(x,y) |  计算x和y中的并集，返回排序好的结果 |<br>|  in1d(x,y) | 返回表示x的元素是否在y中的bool数组  |<br>|  setdiff1d(x,y) | 差集，在x中，不在y中  |<br>|  setxor1d(x,y) | 对称差，找出只出现在一个数组中的元素  |</p>
<p><b>线性代数基础</b></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">说明</th>
<th style="text-align:center">函数</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">diag</td>
<td style="text-align:center">给定矩阵，以一维数组的方式返回对角线元素；给定一维数组，返回以此数组为对角线的方阵</td>
<td style="text-align:center">dot</td>
<td style="text-align:center">矩阵乘法</td>
</tr>
<tr>
<td style="text-align:center">trace</td>
<td style="text-align:center">矩阵的迹</td>
<td style="text-align:center">det</td>
<td style="text-align:center">行列式的值</td>
</tr>
<tr>
<td style="text-align:center">eig</td>
<td style="text-align:center">方阵的特征值和特征向量</td>
<td style="text-align:center">inv</td>
<td style="text-align:center">方阵的逆</td>
</tr>
<tr>
<td style="text-align:center">pinv</td>
<td style="text-align:center">矩阵的Moore-Penrose伪逆</td>
<td style="text-align:center">qr</td>
<td style="text-align:center">计算矩阵的QR分解</td>
</tr>
<tr>
<td style="text-align:center">svd</td>
<td style="text-align:center">奇异值分解</td>
<td style="text-align:center">solve</td>
<td style="text-align:center">计算线性方程组Ax=b，A是方阵</td>
</tr>
<tr>
<td style="text-align:center">lstsq</td>
<td style="text-align:center">计算Ax=b的最小二乘解</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> numpy.linalg <span class="keyword">import</span> inv,qr</span><br><span class="line"></span><br><span class="line">x = np.arange(<span class="number">6</span>).reshape((<span class="number">3</span>,<span class="number">2</span>))</span><br><span class="line">y = np.arange(<span class="number">6</span>).reshape((<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line">x.dot(y)  <span class="comment"># 等同于np.dot(x,y)</span></span><br><span class="line"></span><br><span class="line">q,r = pr(arr)</span><br></pre></td></tr></table></figure>
<p><b>随机数生成</b><br>numpy.random中的部分函数</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">说明</th>
<th style="text-align:center">函数</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">seed</td>
<td style="text-align:center">确定随机数生成器种子</td>
<td style="text-align:center">permutation</td>
<td style="text-align:center">序列的随机排列或一个随机排列的范围</td>
</tr>
<tr>
<td style="text-align:center">shuffle</td>
<td style="text-align:center">对一个序列就地随机排列</td>
<td style="text-align:center">rand</td>
<td style="text-align:center">产生均匀分布的样本值</td>
</tr>
<tr>
<td style="text-align:center">randint</td>
<td style="text-align:center">给定上下限的随机整数选取</td>
<td style="text-align:center">randn</td>
<td style="text-align:center">产生正态分布样本值(mean=0,std=1)</td>
</tr>
<tr>
<td style="text-align:center">binomial</td>
<td style="text-align:center">产生二项分布样本值</td>
<td style="text-align:center">normal</td>
<td style="text-align:center">产生正态分布样本值</td>
</tr>
<tr>
<td style="text-align:center">beta</td>
<td style="text-align:center">产生Beta分布样本值</td>
<td style="text-align:center">chisqaure</td>
<td style="text-align:center">产生卡方分布样本值</td>
</tr>
<tr>
<td style="text-align:center">gama</td>
<td style="text-align:center">产生Gamma分布样本值</td>
<td style="text-align:center">uniform</td>
<td style="text-align:center">产生[0,1]均匀分布样本值</td>
</tr>
</tbody>
</table>
</div>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="atlantic8.github.io/2016/06/23/NumPy基础/" data-id="ck66fynzg006f0wphqrbxhzm1" class="article-share-link"><i class="fas fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/10/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/12/">下一页 &raquo;</a>
    </nav>
</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2019/09/21/CherryPy-Torturial/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Other/">Other</a></p>
                            <p class="item-title"><a href="/2019/09/21/CherryPy-Torturial/" class="title">CherryPy Torturial</a></p>
                            <p class="item-date"><time datetime="2019-09-21T15:51:48.000Z" itemprop="datePublished">2019-09-21</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/12/16/Hough-Transform/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Algorithm/">Algorithm</a></p>
                            <p class="item-title"><a href="/2018/12/16/Hough-Transform/" class="title">Hough Transform</a></p>
                            <p class="item-date"><time datetime="2018-12-16T13:32:21.000Z" itemprop="datePublished">2018-12-16</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/12/16/GRU-and-LSTM/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Algorithm/">Algorithm</a></p>
                            <p class="item-title"><a href="/2018/12/16/GRU-and-LSTM/" class="title">GRU and LSTM</a></p>
                            <p class="item-date"><time datetime="2018-12-16T13:27:29.000Z" itemprop="datePublished">2018-12-16</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/12/16/how-does-shazam-work/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Algorithm/">Algorithm</a></p>
                            <p class="item-title"><a href="/2018/12/16/how-does-shazam-work/" class="title">how does shazam work</a></p>
                            <p class="item-date"><time datetime="2018-12-16T13:06:11.000Z" itemprop="datePublished">2018-12-16</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/08/27/Conditional-Random-Field/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Algorithm/">Algorithm</a></p>
                            <p class="item-title"><a href="/2017/08/27/Conditional-Random-Field/" class="title">Conditional Random Field</a></p>
                            <p class="item-date"><time datetime="2017-08-27T06:19:20.000Z" itemprop="datePublished">2017-08-27</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a><span class="category-list-count">40</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OJ/">OJ</a><span class="category-list-count">53</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a><span class="category-list-count">2</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">35</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">8</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/Backtracking/" style="font-size: 11.11px;">Backtracking</a> <a href="/tags/Binary-Search/" style="font-size: 11.11px;">Binary Search</a> <a href="/tags/Binary-Tree/" style="font-size: 16.67px;">Binary Tree</a> <a href="/tags/Cpp/" style="font-size: 15.56px;">Cpp</a> <a href="/tags/DFS/" style="font-size: 10px;">DFS</a> <a href="/tags/DP/" style="font-size: 16.67px;">DP</a> <a href="/tags/Deep-Learning/" style="font-size: 10px;">Deep Learning</a> <a href="/tags/Divide-Conquer/" style="font-size: 10px;">Divide & Conquer</a> <a href="/tags/Game-Theory/" style="font-size: 10px;">Game Theory</a> <a href="/tags/Geometry/" style="font-size: 10px;">Geometry</a> <a href="/tags/Greedy/" style="font-size: 13.33px;">Greedy</a> <a href="/tags/IPython/" style="font-size: 10px;">IPython</a> <a href="/tags/Java/" style="font-size: 13.33px;">Java</a> <a href="/tags/LeetCode/" style="font-size: 20px;">LeetCode</a> <a href="/tags/MIR/" style="font-size: 10px;">MIR</a> <a href="/tags/Machine-Learning/" style="font-size: 10px;">Machine Learning</a> <a href="/tags/Math/" style="font-size: 12.22px;">Math</a> <a href="/tags/Matlab/" style="font-size: 10px;">Matlab</a> <a href="/tags/NLP/" style="font-size: 12.22px;">NLP</a> <a href="/tags/POJ/" style="font-size: 11.11px;">POJ</a> <a href="/tags/Permutation/" style="font-size: 10px;">Permutation</a> <a href="/tags/STL/" style="font-size: 10px;">STL</a> <a href="/tags/Sliding-window/" style="font-size: 14.44px;">Sliding window</a> <a href="/tags/Sort/" style="font-size: 11.11px;">Sort</a> <a href="/tags/State-Machine/" style="font-size: 10px;">State Machine</a> <a href="/tags/String/" style="font-size: 14.44px;">String</a> <a href="/tags/Tree/" style="font-size: 10px;">Tree</a> <a href="/tags/bit/" style="font-size: 10px;">bit</a> <a href="/tags/deep-learning/" style="font-size: 10px;">deep learning</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/machine-learning/" style="font-size: 18.89px;">machine learning</a> <a href="/tags/music-information-retrieval/" style="font-size: 10px;">music information retrieval</a> <a href="/tags/numpy/" style="font-size: 11.11px;">numpy</a> <a href="/tags/other/" style="font-size: 10px;">other</a> <a href="/tags/pandas/" style="font-size: 11.11px;">pandas</a> <a href="/tags/prime/" style="font-size: 10px;">prime</a> <a href="/tags/python/" style="font-size: 17.78px;">python</a> <a href="/tags/random-algorithm/" style="font-size: 12.22px;">random algorithm</a> <a href="/tags/recommender-system/" style="font-size: 10px;">recommender system</a> <a href="/tags/time-series-data/" style="font-size: 10px;">time_series_data</a> <a href="/tags/visualization/" style="font-size: 10px;">visualization</a> <a href="/tags/web/" style="font-size: 10px;">web</a> <a href="/tags/数据分析/" style="font-size: 10px;">数据分析</a> <a href="/tags/文件/" style="font-size: 10px;">文件</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="https://xueshu.glgoo.org/">Google Scholar Mirror</a>
                    </li>
                
                    <li>
                        <a href="https://www.kaggle.com/">Kaggle</a>
                    </li>
                
                    <li>
                        <a href="http://mlr.cs.umass.edu/ml/datasets.html">UCI dataset</a>
                    </li>
                
                    <li>
                        <a href="https://leetcode.com/problemset/algorithms/">LeetCode</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fas fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2020 Atlantic8<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        </div>
    </div>
</footer>
        


    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>